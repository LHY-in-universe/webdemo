<!DOCTYPE html>
<html lang="zh-CN" data-i18n-title="edgeai.visualization.title">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EdgeAI Visualization v2.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../../shared/css/unified-styles.css?v=1756673003">
    
    <style>
        /* 可视化容器 */
        .visualization-container {
            background: var(--bg-elevated);
            border: 1px solid var(--border-primary);
            border-radius: 16px;
            min-height: 600px;
            position: relative;
            overflow: hidden;
        }
        
        /* SVG样式 */
        .node-svg {
            width: 100%;
            height: 600px;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            pointer-events: auto;
            overflow: hidden;
        }
        
        /* 节点样式 */
        .control-node {
            cursor: pointer;
            transition: fill 0.3s ease, stroke 0.3s ease, stroke-width 0.3s ease;
            transform-origin: center;
            transform: none !important;
            position: static !important;
        }
        
        .edge-node {
            fill: #6b7280;
            stroke: #4b5563;
            stroke-width: 2;
            cursor: pointer;
            transition: fill 0.3s ease, stroke 0.3s ease, stroke-width 0.3s ease;
            transform-origin: center;
            transform: none !important;
            position: static !important;
        }
        
        .edge-node.training {
            fill: #3b82f6;
            stroke: #2563eb;
        }
        
        .edge-node.completed {
            fill: #10b981;
            stroke: #059669;
        }
        
        .edge-node.error {
            fill: #ef4444;
            stroke: #dc2626;
        }
        
        .edge-node:hover {
            stroke-width: 3;
        }
        
        /* 连接线样式 */
        .connection-line {
            stroke: rgba(107, 114, 128, 0.3);
            stroke-width: 2;
            fill: none;
            transition: all 0.3s ease;
        }
        
        .connection-line.active {
            stroke: #10b981;
            stroke-width: 3;
            animation: pulse-line 2s infinite;
        }
        
        .connection-line.inactive {
            stroke: rgba(107, 114, 128, 0.2);
            stroke-width: 1;
            stroke-dasharray: 8,4;
            opacity: 0.6;
        }
        
        /* 发光动画 */
        @keyframes pulse-line {
            0% { stroke-opacity: 0.3; }
            50% { stroke-opacity: 1; }
            100% { stroke-opacity: 0.3; }
        }
        
        @keyframes data-flow {
            0% { stroke-dashoffset: 20; }
            100% { stroke-dashoffset: 0; }
        }
        
        .data-flow {
            stroke-dasharray: 5,5;
            animation: data-flow 1s linear infinite;
        }
        
        /* 节点标签 */
        .node-label {
            font-size: 12px;
            font-weight: 600;
            text-anchor: middle;
            dominant-baseline: middle;
            fill: currentColor;
        }
        
        /* 进度指示器 */
        .progress-ring {
            fill: none;
            stroke-width: 4;
            stroke: #e5e7eb;
        }
        
        .progress-ring.active {
            stroke: #3b82f6;
            stroke-dasharray: 94.2; /* 2π * 15 */
            stroke-dashoffset: 94.2;
            animation: progress-animation 2s ease-in-out;
        }
        
        @keyframes progress-animation {
            to {
                stroke-dashoffset: 0;
            }
        }
        
        /* 节点动画效果 */
        .node-fade-in {
            opacity: 0;
            transform: scale(0.8);
            animation: fadeInScale 0.6s ease-out forwards;
        }
        
        .node-fade-out {
            opacity: 1;
            transform: scale(1);
            animation: fadeOutScale 0.4s ease-in forwards;
        }
        
        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes fadeOutScale {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.8);
            }
        }
        
        /* Training completion status styles */
        .training-complete-title {
            font-size: 32px;
            font-weight: bold;
            fill: #10b981;
            opacity: 0;
            animation: celebrationFadeIn 1s ease-out 0.5s forwards;
        }
        
        .training-complete-subtitle {
            font-size: 18px;
            font-weight: 600;
            fill: #059669;
            opacity: 0;
            animation: celebrationFadeIn 1s ease-out 1s forwards;
        }
        
        .training-complete-stats {
            font-size: 14px;
            fill: #6b7280;
            opacity: 0;
            animation: celebrationFadeIn 1s ease-out 1.5s forwards;
        }
        
        @keyframes celebrationFadeIn {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Dark mode adaptation */
        [data-theme="dark"] .visualization-container {
            background: rgba(31, 41, 55, 0.8);
            border-color: rgba(75, 85, 99, 0.4);
        }
        
        [data-theme="dark"] .node-label {
            fill: #f9fafb;
        }
        
        [data-theme="dark"] .connection-line {
            stroke: rgba(156, 163, 175, 0.4);
        }
        
        [data-theme="dark"] .connection-line.inactive {
            stroke: rgba(156, 163, 175, 0.2);
            opacity: 0.4;
        }
        
        /* 控制面板 */
        .control-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 24px;
            width: 440px;
            box-shadow: var(--shadow-lg);
            z-index: 10;
        }
        
        [data-theme="dark"] .control-panel {
            background: rgba(31, 41, 55, 0.9);
            border-color: rgba(75, 85, 99, 0.4);
        }
        
        /* 节点详情面板 */
        .node-details {
            position: absolute;
            top: 20px;
            right: 480px;
            width: 360px;
            max-height: 560px;
            overflow-y: auto;
            background: var(--bg-elevated);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow-lg);
            transform: translateX(calc(100% + 500px));
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .node-details.show {
            transform: translateX(0);
        }
        
        [data-theme="dark"] .node-details {
            background: rgba(31, 41, 55, 0.95);
            border-color: rgba(75, 85, 99, 0.4);
            color: rgba(243, 244, 246, 0.9);
        }
        
        /* 深色模式下节点详情面板内容样式 */
        [data-theme="dark"] .node-details .space-y-3 > div {
            background-color: rgba(55, 65, 81, 0.3);
            border-radius: 6px;
            padding: 8px 12px;
            margin: 4px 0;
        }
        
        [data-theme="dark"] .node-details h4 {
            color: rgba(243, 244, 246, 0.9);
        }
        
        [data-theme="dark"] .node-details .text-sm {
            color: rgba(156, 163, 175, 0.9);
        }
        
        [data-theme="dark"] .node-details .font-semibold {
            color: rgba(243, 244, 246, 0.95);
        }
        
        /* 概览卡片 */
        .overview-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        [data-theme="dark"] .overview-card {
            background: rgba(31, 41, 55, 0.9);
            border-color: rgba(75, 85, 99, 0.4);
        }
        
        /* 深色模式下的表格和卡片样式 */
        [data-theme="dark"] table {
            background: rgba(31, 41, 55, 0.9);
        }
        
        [data-theme="dark"] .bg-white {
            background-color: rgba(31, 41, 55, 0.8) !important;
        }
        
        [data-theme="dark"] .bg-gray-50 {
            background-color: rgba(55, 65, 81, 0.8) !important;
        }
        
        [data-theme="dark"] .hover\:bg-gray-50:hover {
            background-color: rgba(75, 85, 99, 0.6) !important;
        }
        
        [data-theme="dark"] .text-gray-900 {
            color: rgba(243, 244, 246, 0.9) !important;
        }
        
        [data-theme="dark"] .text-gray-600 {
            color: rgba(156, 163, 175, 0.9) !important;
        }
        
        [data-theme="dark"] .text-gray-500 {
            color: rgba(107, 114, 128, 0.9) !important;
        }
        
        [data-theme="dark"] .border-gray-200 {
            border-color: rgba(75, 85, 99, 0.4) !important;
        }
        
        [data-theme="dark"] .divide-gray-200 > :not([hidden]) ~ :not([hidden]) {
            border-color: rgba(75, 85, 99, 0.4) !important;
        }
        
        /* 深色模式下表格行背景 */
        [data-theme="dark"] tbody tr {
            background-color: rgba(31, 41, 55, 0.8) !important;
        }
        
        [data-theme="dark"] tbody tr:hover {
            background-color: rgba(75, 85, 99, 0.6) !important;
        }
        
        /* 深色模式下按钮样式 */
        [data-theme="dark"] .cursor-pointer:hover {
            background-color: rgba(75, 85, 99, 0.6) !important;
        }
        
        /* 深色模式下进度条 */
        [data-theme="dark"] .bg-gray-200 {
            background-color: rgba(55, 65, 81, 0.8) !important;
        }
        
        /* 深色模式下状态标签背景 */
        [data-theme="dark"] .bg-blue-100 {
            background-color: rgba(59, 130, 246, 0.2) !important;
        }
        
        [data-theme="dark"] .bg-green-100 {
            background-color: rgba(16, 185, 129, 0.2) !important;
        }
        
        [data-theme="dark"] .bg-red-100 {
            background-color: rgba(239, 68, 68, 0.2) !important;
        }
        
        [data-theme="dark"] .bg-gray-100 {
            background-color: rgba(55, 65, 81, 0.6) !important;
        }
        
        /* 深色模式下链接和按钮颜色 */
        [data-theme="dark"] .text-indigo-600 {
            color: rgba(129, 140, 248, 0.9) !important;
        }
        
        [data-theme="dark"] .hover\:text-indigo-900:hover {
            color: rgba(165, 180, 252, 0.9) !important;
        }
        
        /* 深色模式下表格中的查看详情按钮 */
        [data-theme="dark"] td button.text-indigo-600 {
            background-color: transparent !important;
            border-color: rgba(129, 140, 248, 0.5) !important;
            color: rgba(129, 140, 248, 0.9) !important;
            pointer-events: auto !important;
            cursor: pointer !important;
        }
        
        [data-theme="dark"] td button.text-indigo-600:hover {
            background-color: rgba(55, 65, 81, 0.3) !important;
            border-color: rgba(165, 180, 252, 0.8) !important;
            color: rgba(165, 180, 252, 1) !important;
        }
        
        [data-theme="dark"] thead {
            background: rgba(55, 65, 81, 0.8);
        }
        
        /* 详细信息模态卡片 */
        .node-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .node-modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .node-modal-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            width: 90%;
            max-width: 900px;
            max-height: 85vh;
            overflow-y: auto;
            transform: translateY(20px) scale(0.95);
            transition: all 0.3s ease;
        }
        
        .node-modal.show .node-modal-card {
            transform: translateY(0) scale(1);
        }
        
        /* 深色模式下的模态卡片 */
        [data-theme="dark"] .node-modal-card {
            background: rgba(31, 41, 55, 0.95);
            border: 1px solid rgba(75, 85, 99, 0.3);
            color: rgba(243, 244, 246, 0.9);
        }

        [data-theme="dark"] .node-modal-card .bg-gray-50 {
            background: rgba(55, 65, 81, 0.6) !important;
        }

        [data-theme="dark"] .node-modal-card .text-gray-900 {
            color: rgba(243, 244, 246, 0.9) !important;
        }

        [data-theme="dark"] .node-modal-card .text-gray-600 {
            color: rgba(156, 163, 175, 0.9) !important;
        }

        [data-theme="dark"] .node-modal-card .text-gray-700 {
            color: rgba(209, 213, 219, 0.9) !important;
        }

        [data-theme="dark"] .node-modal-card .bg-blue-100 {
            background: rgba(55, 65, 81, 0.8) !important;
            color: rgba(129, 140, 248, 0.9) !important;
        }

        [data-theme="dark"] .node-modal-card .bg-white {
            background: rgba(75, 85, 99, 0.4) !important;
        }

        [data-theme="dark"] .node-modal-card .border-gray-200 {
            border-color: rgba(75, 85, 99, 0.5) !important;
        }

        [data-theme="dark"] .node-modal-card .text-gray-400 {
            color: rgba(156, 163, 175, 0.8) !important;
        }

        [data-theme="dark"] .node-modal-card .text-gray-500 {
            color: rgba(107, 114, 128, 0.9) !important;
        }

        /* 深色模式下所有button元素的默认样式 */
        [data-theme="dark"] button:not(.text-indigo-600) {
            background-color: rgba(55, 65, 81, 0.7) !important;
            border-color: rgba(75, 85, 99, 0.5) !important;
            color: rgba(243, 244, 246, 0.9) !important;
        }
        
        [data-theme="dark"] button:not(.text-indigo-600):hover {
            background-color: rgba(75, 85, 99, 0.8) !important;
        }
        
        /* 深色模式下的统计卡片文字 */
        [data-theme="dark"] .text-center .text-sm {
            color: rgba(156, 163, 175, 0.9) !important;
        }
        
        [data-theme="dark"] tbody tr {
            background: rgba(31, 41, 55, 0.8);
            border-color: rgba(75, 85, 99, 0.3);
        }
        
        [data-theme="dark"] tbody tr:hover {
            background: rgba(55, 65, 81, 0.6);
        }
        
        [data-theme="dark"] th,
        [data-theme="dark"] td {
            color: rgba(243, 244, 246, 0.9);
        }
        
        /* 项目信息头部暗色主题 */
        [data-theme="dark"] .project-info-header .bg-white {
            background: rgba(31, 41, 55, 0.9) !important;
            border-color: rgba(75, 85, 99, 0.4) !important;
        }
        
        [data-theme="dark"] .project-info-header h2 {
            color: rgba(243, 244, 246, 0.95) !important;
        }
        
        [data-theme="dark"] .project-info-header p {
            color: rgba(156, 163, 175, 0.9) !important;
        }

        /* 进度条光效动画 */
        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }
        
        .animate-shimmer {
            animation: shimmer 2s infinite;
        }
        
        /* 进度条渐变效果增强 */
        #overallProgressBar {
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        
        /* 阶段指示器样式增强 */
        .stage-indicator {
            position: relative;
            padding: 2px 8px;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .stage-indicator.active {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
            font-weight: 600;
        }
        
        /* 颜色呼吸效果动画 */
        @keyframes color-breathing {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.4;
            }
        }
        
        /* 边缘节点颜色呼吸效果 */
        .edge-node.breathing {
            animation: color-breathing 2s ease-in-out infinite;
        }
        
        /* 连接线默认透明 */
        .connection-line {
            stroke: #10b981;
            stroke-width: 2;
            stroke-opacity: 0;
            fill: none;
            transition: stroke-opacity 0.3s ease;
        }
        
        /* 数据流动线段动画 */
        @keyframes data-segment-down {
            0% {
                stroke-dasharray: 25, 1000;
                stroke-dashoffset: 1025;
                stroke-opacity: 0.9;
            }
            50% {
                stroke-opacity: 1;
            }
            100% {
                stroke-dasharray: 25, 1000;
                stroke-dashoffset: 0;
                stroke-opacity: 0.9;
            }
        }
        
        @keyframes data-segment-up {
            0% {
                stroke-dasharray: 25, 1000;
                stroke-dashoffset: 0;
                stroke-opacity: 0.9;
            }
            50% {
                stroke-opacity: 1;
            }
            100% {
                stroke-dasharray: 25, 1000;
                stroke-dashoffset: -1025;
                stroke-opacity: 0.9;
            }
        }
        
        /* 数据传输时显示流动线段 */
        .connection-line.transmitting-down {
            animation: data-segment-down 4s ease-in-out;
        }
        
        .connection-line.transmitting-up {
            animation: data-segment-up 4s ease-in-out;
        }
        
    </style>
</head>
<body class="module-background theme-transition">
    <!-- Navigation -->
    <nav class="navbar fade-in-up">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="navbar-brand">
                <button onclick="goBack()" class="btn btn-secondary mr-3 btn-click">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back
                </button>
                <span data-i18n="edgeai.visualization.title">Project Visualization</span>
                <span id="projectName" class="ml-2 text-sm text-gray-600"></span>
            </div>
            
            <div class="navbar-nav">
                <button class="theme-toggle" title="Toggle Theme">
                    <span>🌙</span>
                </button>
                <button class="language-toggle" title="Switch Language">EN</button>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-6 py-8 content-area">
        <!-- Project Information Area -->
        <div class="project-info-header mb-8 fade-in-up">
            <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm">
                <div class="flex items-start justify-between mb-6">
                    <div class="flex-1">
                        <h2 id="projectTitle" class="text-2xl font-bold text-gray-900 mb-2">Strawberry Robot Agricultural Training</h2>
                        <p id="projectDescription" class="text-gray-600 mb-4">EdgeAI-based strawberry harvesting robot training system using LLM models for intelligent fruit recognition and automated picking optimization.</p>
                        
                        <div class="flex flex-wrap items-center gap-x-8 gap-y-2 text-sm">
                            <div class="flex items-center whitespace-nowrap">
                                <div id="statusDot" class="w-2 h-2 bg-green-500 rounded-full mr-2 flex-shrink-0"></div>
                                <span class="text-gray-500">Status:</span>
                                <span id="projectStatus" class="font-semibold text-green-600 ml-2">Training</span>
                            </div>
                            <div class="flex items-center whitespace-nowrap">
                                <svg class="w-4 h-4 text-gray-400 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="text-gray-500">Created:</span>
                                <span id="projectCreated" class="font-medium ml-2">2024-01-15</span>
                            </div>
                            <div class="flex items-center whitespace-nowrap">
                                <svg class="w-4 h-4 text-gray-400 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                <span class="text-gray-500">Last Updated:</span>
                                <span id="projectUpdated" class="font-medium ml-2">2 hours ago</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4 ml-6">
                        <!-- 整体进度圆环 -->
                        <div class="relative w-20 h-20">
                            <svg class="w-20 h-20 transform -rotate-90" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="40" stroke="currentColor" stroke-width="8" fill="transparent" class="text-gray-200"></circle>
                                <circle id="progressCircle" cx="50" cy="50" r="40" stroke="currentColor" stroke-width="8" fill="transparent" stroke-dasharray="251.2" stroke-dashoffset="62.8" class="text-green-500 transition-all duration-500"></circle>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span id="overallProgress" class="text-lg font-bold text-gray-900">75%</span>
                            </div>
                        </div>
                        
                        <!-- 快速统计 -->
                        <div class="text-right space-y-1">
                            <div class="text-2xl font-bold text-gray-900" id="quickNodeCount">15</div>
                            <div class="text-sm text-gray-500">Total Nodes</div>
                            <div class="text-sm">
                                <span class="text-green-600 font-semibold" id="quickOnlineCount">12</span> 
                                <span class="text-gray-400">/</span> 
                                <span class="text-blue-600 font-semibold" id="quickTrainingCount">8</span> Training
                            </div>
                        </div>
                    </div>
                    
                    <!-- 整体训练进度条 -->
                    <div class="mt-4 px-2">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700">Overall Training Progress</span>
                            <span class="text-sm text-gray-500" id="progressDetails">Round 187/250</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 relative overflow-hidden">
                            <!-- 背景渐变 -->
                            <div class="absolute inset-0 bg-gradient-to-r from-blue-100 to-green-100 rounded-full"></div>
                            <!-- 进度条 -->
                            <div id="overallProgressBar" class="bg-gradient-to-r from-blue-500 via-blue-600 to-green-500 h-3 rounded-full transition-all duration-1000 ease-out relative overflow-hidden" style="width: 75%">
                                <!-- 动态光效 -->
                                <div class="absolute top-0 -inset-full h-full bg-gradient-to-r from-transparent via-white to-transparent opacity-30 animate-shimmer"></div>
                            </div>
                        </div>
                        <!-- 阶段指示器 -->
                        <div class="flex justify-between mt-2 text-xs text-gray-500">
                            <span id="stage1" class="stage-indicator">Initialization</span>
                            <span id="stage2" class="stage-indicator active">Training</span>
                            <span id="stage3" class="stage-indicator">Convergence Complete</span>
                        </div>
                    </div>
                </div>
                
                <!-- 项目配置信息 -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 pt-4 border-t border-gray-100">
                    <div class="text-center">
                        <div class="text-sm text-gray-500 mb-1">AI Model</div>
                        <div class="font-semibold text-gray-900" id="aiModelType">OpenVLA</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm text-gray-500 mb-1">Training Strategy</div>
                        <div class="font-semibold text-gray-900" id="trainingStrategy">dpo</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm text-gray-500 mb-1">Protocol</div>
                        <div class="font-semibold text-gray-900" id="Protocol">fedavg</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm text-gray-500 mb-1">Target Accuracy</div>
                        <div class="font-semibold text-gray-900" id="targetAccuracy">≥95%</div>
                    </div>
                    <div class="text-center">
                        <div class="text-sm text-gray-500 mb-1">Estimated Completion</div>
                        <div class="font-semibold text-gray-900" id="estimatedTime">3 days</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 可视化主容器 -->
        <div class="visualization-container mb-8 fade-in-up delay-1">
            <svg id="networkSvg" class="node-svg">
                <!-- 背景网格 -->
                <defs>
                    <pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse">
                        <path d="M 50 0 L 0 0 0 50" fill="none" stroke="currentColor" stroke-width="0.5" opacity="0.1"/>
                    </pattern>
                </defs>
                <rect width="100%" height="100%" fill="url(#grid)" />
                
                <!-- 连接线层 -->
                <g id="connections"></g>
                
                <!-- 节点层 -->
                <g id="nodes"></g>
                
                <!-- 标签层 -->
                <g id="labels"></g>
                
                <!-- 训练完成状态覆盖层 -->
                <g id="trainingComplete" style="display: none;">
                    <!-- 背景遮罩 -->
                    <rect width="100%" height="100%" fill="rgba(16, 185, 129, 0.1)" rx="10"/>
                    
                    <!-- Training Complete Status Text -->
                    <text x="50%" y="40%" text-anchor="middle" class="training-complete-title">
                        🎉 Training Complete 🎉
                    </text>
                    
                    <text x="50%" y="50%" text-anchor="middle" class="training-complete-subtitle">
                        All edge nodes have completed training tasks
                    </text>
                    
                    <text x="50%" y="60%" text-anchor="middle" class="training-complete-stats" id="trainingCompleteStats">
                        Completed training on 0 nodes
                    </text>
                </g>
            </svg>
            
            <!-- 控制面板 -->
            <div class="control-panel">
                <h4 class="text-lg font-semibold mb-4" data-i18n="edgeai.visualization.controls">Control Panel</h4>
                
                <!-- Button Grid Layout -->
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <button onclick="showInviteUserModal()" class="btn btn-primary btn-click text-sm py-3 px-4">
                        <span data-i18n="edgeai.visualization.inviteUser">Invite User</span>
                    </button>
                    <button onclick="showAddNodeModal()" class="btn btn-secondary btn-click text-sm py-3 px-4">
                        <span data-i18n="edgeai.visualization.addNode">Add Node</span>
                    </button>
                    <button onclick="startTraining()" class="btn btn-secondary btn-click text-sm py-3 px-4">
                        <span data-i18n="edgeai.visualization.startTraining">Start Training</span>
                    </button>
                    <button onclick="resetView()" class="btn btn-secondary btn-click text-sm py-3 px-4">
                        <span data-i18n="edgeai.visualization.resetView">Reset View</span>
                    </button>
                </div>
                
                <!-- Test Button in Separate Row -->
                <div class="mb-6">
                    <button onclick="completeAllTraining()" class="btn btn-success btn-click w-full text-sm py-3">
                        <span>Complete Training (Test)</span>
                    </button>
                </div>
                
                <!-- Real-time Status -->
                <div class="pt-4 border-t border-gray-200">
                    <h5 class="text-base font-medium text-gray-600 mb-3">Real-time Status</h5>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600" id="onlineNodes">8</div>
                            <div class="text-sm text-gray-600">Online Nodes</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-600" id="trainingNodes">3</div>
                            <div class="text-sm text-gray-600">Training</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-purple-600" id="dataTransfer">1.2MB/s</div>
                            <div class="text-sm text-gray-600">Data Transfer</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Node Details Panel -->
            <div id="nodeDetails" class="node-details">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-lg font-semibold" id="nodeTitle">Node Details</h4>
                    <button onclick="closeNodeDetails()" class="btn btn-secondary btn-click text-sm py-2 px-4">
                        Close
                    </button>
                </div>
                <div id="nodeInfo" class="space-y-3">
                    <!-- Node information will be dynamically populated here -->
                </div>
            </div>
        </div>

        <!-- 邀请用户模态卡片 -->
        <div id="inviteUserModal" class="node-modal">
            <div class="node-modal-card" style="max-width: 600px;">
                <div class="p-6">
                    <!-- 卡片头部 -->
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900">邀请用户</h2>
                                <p class="text-gray-600">邀请其他用户参与EdgeAI项目</p>
                            </div>
                        </div>
                        <button onclick="closeInviteUserModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- 邀请表单 -->
                    <div class="space-y-6">
                        <!-- 邮箱输入 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">用户邮箱</label>
                            <div class="flex space-x-3">
                                <input type="email" id="inviteEmail" placeholder="请输入用户邮箱地址" 
                                       onkeypress="if(event.key==='Enter') addEmailToList()"
                                       class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <button onclick="addEmailToList()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                    添加
                                </button>
                            </div>
                        </div>

                        <!-- 邮箱列表 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">待邀请用户列表</label>
                            <div id="inviteEmailList" class="min-h-[100px] border border-gray-200 rounded-lg p-3 space-y-2">
                                <!-- 动态添加的邮箱列表 -->
                                <div class="text-gray-500 text-sm">暂无待邀请用户</div>
                            </div>
                        </div>

                        <!-- 权限选择 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">用户权限</label>
                            <div class="grid grid-cols-2 gap-3">
                                <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="userRole" value="participant" checked class="mr-3">
                                    <div>
                                        <div class="font-medium">参与者</div>
                                        <div class="text-sm text-gray-500">可参与训练</div>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="userRole" value="observer" class="mr-3">
                                    <div>
                                        <div class="font-medium">观察者</div>
                                        <div class="text-sm text-gray-500">仅查看权限</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- 邀请消息 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">邀请消息 (可选)</label>
                            <textarea id="inviteMessage" rows="3" placeholder="请输入邀请消息..." 
                                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">您好，我邀请您参与我们的EdgeAI项目。期待与您合作！</textarea>
                        </div>
                    </div>

                    <!-- Bottom Action Buttons -->
                    <div class="flex justify-end space-x-3 mt-8 pt-6 border-t border-gray-200">
                        <button onclick="closeInviteUserModal()" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors">
                            取消
                        </button>
                        <button onclick="sendInvitations()" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors">
                            发送邀请
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 添加节点模态卡片 -->
        <div id="addNodeModal" class="node-modal">
            <div class="node-modal-card" style="max-width: 700px;">
                <div class="p-6">
                    <!-- 卡片头部 -->
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900">添加节点</h2>
                                <p class="text-gray-600">添加新的边缘节点到训练网络</p>
                            </div>
                        </div>
                        <button onclick="closeAddNodeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- 添加节点表单 -->
                    <div class="space-y-6">
                        <!-- 节点基础信息 -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">节点名称</label>
                                <input type="text" id="nodeName" placeholder="例如：节点21" 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">节点地址</label>
                                <input type="text" id="nodeAddress" placeholder="http://192.168.1.121:8080" 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            </div>
                        </div>

                        <!-- 节点类型选择 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">节点类型</label>
                            <div class="grid grid-cols-3 gap-3">
                                <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="nodeType" value="edge" checked class="mr-3">
                                    <div>
                                        <div class="font-medium">边缘节点</div>
                                        <div class="text-sm text-gray-500">参与训练</div>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="nodeType" value="control" class="mr-3">
                                    <div>
                                        <div class="font-medium">控制节点</div>
                                        <div class="text-sm text-gray-500">协调训练</div>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="nodeType" value="observer" class="mr-3">
                                    <div>
                                        <div class="font-medium">观察节点</div>
                                        <div class="text-sm text-gray-500">仅监控</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- 连接配置 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">连接到控制节点</label>
                            <select id="connectToControl" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <option value="">选择控制节点...</option>
                                <option value="http://192.168.1.100:8080">主控节点1 (192.168.1.100:8080)</option>
                                <option value="http://192.168.1.101:8080">主控节点2 (192.168.1.101:8080)</option>
                                <option value="http://192.168.1.102:8080">备用控制 (192.168.1.102:8080)</option>
                            </select>
                        </div>

                        <!-- Resource Configuration */
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Expected Resource Configuration</label>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">CPU Cores</label>
                                    <input type="number" id="nodeCpuCores" placeholder="4" min="1" max="64" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">Memory (GB)</label>
                                    <input type="number" id="nodeMemory" placeholder="8" min="1" max="128" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">GPU Type</label>
                                    <select id="nodeGpuType" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                        <option value="">No GPU</option>
                                        <option value="rtx3080">RTX 3080</option>
                                        <option value="rtx3090">RTX 3090</option>
                                        <option value="rtx4090">RTX 4090</option>
                                        <option value="tesla">Tesla Series</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Security Configuration -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Security Configuration</label>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" id="enableSSL" checked class="mr-3">
                                    <span>Enable SSL Encrypted Communication</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="enableAuth" checked class="mr-3">
                                    <span>Enable Node Authentication</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="enableMonitoring" checked class="mr-3">
                                    <span>Enable Performance Monitoring</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- 底部操作按钮 -->
                    <div class="flex justify-end space-x-3 mt-8 pt-6 border-t border-gray-200">
                        <button onclick="closeAddNodeModal()" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors">
                            取消
                        </button>
                        <button onclick="testNodeConnection()" class="px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg transition-colors">
                            测试连接
                        </button>
                        <button onclick="addNewNode()" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors">
                            添加节点
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 详细信息模态卡片 -->
        <div id="nodeModal" class="node-modal">
            <div class="node-modal-card">
                <div class="p-6">
                    <!-- 卡片头部 -->
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                <div class="w-6 h-6 bg-blue-500 rounded-full"></div>
                            </div>
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900" id="modalNodeTitle">节点详情</h2>
                                <p class="text-gray-600" id="modalNodeStatus">状态信息</p>
                            </div>
                        </div>
                        <button onclick="closeNodeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Main Content Area -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Left Side: Basic Information and Connection Info -->
                        <div class="space-y-6">
                            <!-- Basic Information Card -->
                            <div class="bg-gray-50 rounded-lg p-6">
                                <h3 class="text-lg font-semibold mb-4 text-gray-900">Basic Information</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Node Name:</span>
                                        <span class="font-semibold" id="modalNodeName">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Node Address:</span>
                                        <span class="font-mono text-sm bg-blue-100 px-2 py-1 rounded" id="modalNodeUrl">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Training Rounds:</span>
                                        <span class="font-semibold" id="modalTrainingRounds">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Training Progress:</span>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-20 bg-gray-200 rounded-full h-2">
                                                <div class="bg-blue-600 h-2 rounded-full" id="modalProgressBar"></div>
                                            </div>
                                            <span class="font-semibold text-blue-600" id="modalProgress">-</span>
                                        </div>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Heartbeat Status:</span>
                                        <span class="font-semibold text-green-600" id="modalHeartbeat">-</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Connection Information Card -->
                            <div class="bg-gray-50 rounded-lg p-6">
                                <h3 class="text-lg font-semibold mb-4 text-gray-900">Network Connection</h3>
                                <div class="space-y-3">
                                    <div>
                                        <span class="text-gray-600 block mb-2">Connected to Control Node:</span>
                                        <div class="space-y-1" id="modalConnectedNodes">
                                            <!-- Dynamically populated connected nodes -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Side: Performance Monitoring and Training Statistics -->
                        <div class="space-y-6">
                            <!-- Performance Monitoring Card -->
                            <div class="bg-gray-50 rounded-lg p-6">
                                <h3 class="text-lg font-semibold mb-4 text-gray-900">Resource Usage</h3>
                                <div class="space-y-4">
                                    <!-- CPU Usage -->
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm text-gray-600">CPU Usage</span>
                                            <span class="text-sm font-semibold" id="modalCpuValue">-</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-3">
                                            <div class="bg-blue-600 h-3 rounded-full transition-all duration-500" id="modalCpuBar"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- GPU Usage -->
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm text-gray-600">GPU Usage</span>
                                            <span class="text-sm font-semibold" id="modalGpuValue">-</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-3">
                                            <div class="bg-green-600 h-3 rounded-full transition-all duration-500" id="modalGpuBar"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Memory Usage -->
                                    <div>
                                        <div class="flex justify-between mb-1">
                                            <span class="text-sm text-gray-600">Memory Usage</span>
                                            <span class="text-sm font-semibold" id="modalMemoryValue">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Training Statistics Card -->
                            <div class="bg-gray-50 rounded-lg p-6" id="modalTrainingStats" style="display: none;">
                                <h3 class="text-lg font-semibold mb-4 text-gray-900" id="modalTrainingStatsTitle">Training Statistics</h3>
                                <div class="grid grid-cols-2 gap-4 mb-6">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-green-600" id="modalAccuracy">-</div>
                                        <div class="text-sm text-gray-600" id="modalAccuracyLabel">Current Accuracy</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-red-600" id="modalLoss">-</div>
                                        <div class="text-sm text-gray-600" id="modalLossLabel">Loss Value</div>
                                    </div>
                                </div>
                                
                                <!-- Historical Trend Chart -->
                                <div>
                                    <h4 class="text-sm font-semibold mb-2 text-gray-700" id="modalChartTitle">Accuracy Historical Trend</h4>
                                    <div class="h-24 bg-white rounded p-3 relative">
                                        <svg width="100%" height="100%" id="modalAccuracyChart" class="overflow-visible">
                                            <!-- SVG curve chart will be generated here -->
                                        </svg>
                                        <div class="absolute bottom-1 left-3 right-3 flex justify-between text-xs text-gray-400">
                                            <span id="modalRoundStart">Round</span>
                                            <span id="modalRoundEnd">Current</span>
                                        </div>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-2" id="modalAccuracyHistory">Historical Data</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 底部操作按钮 -->
                    <div class="flex justify-end space-x-3 mt-8 pt-6 border-t border-gray-200" id="modalActionButtons">
                        <button id="stopTrainingBtn" onclick="stopTraining()" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors">
                            Stop Training
                        </button>
                        <button id="restartTrainingBtn" onclick="restartTraining()" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors">
                            Restart Training
                        </button>
                        <button id="exportResultBtn" onclick="exportTrainingResult()" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors" style="display: none;">
                            Export Results
                        </button>
                        <button onclick="closeNodeModal()" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 概览卡片区域 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 fade-in-up delay-2">
            <div class="overview-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600" data-i18n="edgeai.visualization.totalNodes">总节点数</p>
                        <p class="text-2xl font-bold text-gray-900" id="totalNodesCount">12</p>
                    </div>
                    <div class="text-3xl">🖥️</div>
                </div>
            </div>
            
            <div class="overview-card">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <p class="text-sm text-gray-600" data-i18n="edgeai.visualization.avgProgress">平均进度</p>
                        <p class="text-2xl font-bold text-blue-600" id="avgProgress">67%</p>
                        <!-- 平均进度条 -->
                        <div class="mt-3 w-full">
                            <div class="w-full bg-gray-200 rounded-full h-2 relative overflow-hidden">
                                <div id="avgProgressBar" class="bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all duration-800 ease-out relative" style="width: 67%">
                                    <!-- 微光效果 -->
                                    <div class="absolute top-0 -inset-full h-full bg-gradient-to-r from-transparent via-white to-transparent opacity-40 animate-shimmer"></div>
                                </div>
                            </div>
                            <!-- 进度标签 -->
                            <div class="flex justify-between mt-1 text-xs text-gray-500">
                                <span>0%</span>
                                <span>100%</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-3xl ml-2">📊</div>
                </div>
            </div>
            
            <div class="overview-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600" data-i18n="edgeai.visualization.networkLatency">Network Latency</p>
                        <p class="text-2xl font-bold text-green-600" id="networkLatency">23ms</p>
                    </div>
                    <div class="text-3xl">⚡</div>
                </div>
            </div>
            
            <div class="overview-card">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600" data-i18n="edgeai.visualization.systemHealth">System Health</p>
                        <p class="text-2xl font-bold text-purple-600" id="systemHealth">Good</p>
                    </div>
                    <div class="text-3xl">💚</div>
                </div>
            </div>
        </div>

        <!-- 节点详情列表 -->
        <div class="mt-12 fade-in-up delay-3">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900" data-i18n="edgeai.visualization.nodeList">Node Details List</h3>
                <div class="flex items-center space-x-4 text-sm text-gray-600">
                    <span>Control Nodes: <span class="font-semibold text-green-600" id="controlNodeCount">3</span></span>
                    <span>Edge Nodes: <span class="font-semibold text-blue-600" id="edgeNodeCount">12</span></span>
                    <span>Total: <span class="font-semibold text-gray-900" id="totalNodeCount">15</span></span>
                </div>
            </div>
            
            <!-- 控制节点表格 -->
            <div class="mb-8">
                <h4 class="text-lg font-semibold mb-4 text-green-600">Control Nodes (Max 15)</h4>
                <div class="overflow-x-auto bg-white rounded-lg shadow">
                    <table class="min-w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Node Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Responsible User</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">IP Address</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Connected Nodes</th>
                            </tr>
                        </thead>
                        <tbody id="controlNodesTable" class="bg-white divide-y divide-gray-200">
                            <!-- 动态填充 -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 边缘节点表格 -->
            <div class="mb-8">
                <h4 class="text-lg font-semibold mb-4 text-blue-600">Edge Nodes (Max 15)</h4>
                <div class="overflow-x-auto bg-white rounded-lg shadow">
                    <table class="min-w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none" onclick="sortEdgeNodes('name')">
                                    Node Name <span id="sort-name" class="ml-1">⇅</span>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none" onclick="sortEdgeNodes('status')">
                                    Status <span id="sort-status" class="ml-1">⇅</span>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none" onclick="sortEdgeNodes('progress')">
                                    Training Progress <span id="sort-progress" class="ml-1">⇅</span>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none" onclick="sortEdgeNodes('cpu')">
                                    CPU <span id="sort-cpu" class="ml-1">⇅</span>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none" onclick="sortEdgeNodes('memory')">
                                    Memory <span id="sort-memory" class="ml-1">⇅</span>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none" onclick="sortEdgeNodes('gpu')">
                                    GPU <span id="sort-gpu" class="ml-1">⇅</span>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none" onclick="sortEdgeNodes('heartbeat')">
                                    Last Heartbeat <span id="sort-heartbeat" class="ml-1">⇅</span>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="edgeNodesTable" class="bg-white divide-y divide-gray-200">
                            <!-- 动态填充 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 返回主页按钮 -->
    <button class="homepage-return-btn btn-click" onclick="goHome()" title="返回主页">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
        </svg>
    </button>

    <script src="../../shared/js/theme-manager-unified.js?v=20250827"></script>
    <script src="../../shared/js/i18n-manager.js?v=1756649655"></script>
    <!-- <script src="../../shared/js/router-unified.js?v=20250827"></script> -->
    
    <script>
        // 生成随机控制节点颜色
        function generateRandomNodeColor() {
            const colors = [
                { fill: '#3b82f6', stroke: '#2563eb' }, // 蓝色
                { fill: '#8b5cf6', stroke: '#7c3aed' }, // 紫色
                { fill: '#f59e0b', stroke: '#d97706' }, // 橙色
                { fill: '#ef4444', stroke: '#dc2626' }, // 红色
                { fill: '#10b981', stroke: '#059669' }, // 绿色
                { fill: '#f97316', stroke: '#ea580c' }, // 深橙色
                { fill: '#84cc16', stroke: '#65a30d' }, // 青绿色
                { fill: '#06b6d4', stroke: '#0891b2' }, // 青色
                { fill: '#ec4899', stroke: '#db2777' }, // 粉色
                { fill: '#6366f1', stroke: '#4f46e5' }  // 靛蓝色
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // 获取项目ID
        const urlParams = new URLSearchParams(window.location.search);
        const projectId = urlParams.get('project') || 1;
        
        // 初始化控制节点颜色
        const edgeColor1 = generateRandomNodeColor();
        const edgeColor2 = generateRandomNodeColor();
        const edgeColor3 = generateRandomNodeColor();
        
        // Simulated network data
        const networkData = {
            controlNodes: [
                { 
                    id: 'control-1', 
                    x: 200, 
                    y: 80, 
                    name: 'Model Node 1', 
                    type: 'model node', 
                    status: 'active', 
                    user: 'Administrator', 
                    ip: '192.168.1.100',
                    color: { fill: edgeColor1.fill, stroke: edgeColor1.stroke, name: 'random1' }
                },
                { 
                    id: 'control-2', 
                    x: 400, 
                    y: 80, 
                    name: 'Model Node 2', 
                    type: 'model node', 
                    status: 'active', 
                    user: 'Coordinator', 
                    ip: '192.168.1.101',
                    color: { fill: edgeColor2.fill, stroke: edgeColor2.stroke, name: 'random2' }
                },
                { 
                    id: 'Model Node 3', 
                    x: 600, 
                    y: 80, 
                    name: 'Backup Control', 
                    type: 'model node', 
                    status: 'active', 
                    user: 'Observer', 
                    ip: '192.168.1.102',
                    color: { fill: edgeColor3.fill, stroke: edgeColor3.stroke, name: 'random3' }
                }
            ],
            // All edge nodes (can be added infinitely, visualization interface only shows active 15)
            allEdgeNodes: [
                // Training nodes
                { 
                    id: 'edge-1', name: 'Training Node 01', status: 'training', progress: 97, cpu: 68, memory: '1.8GB', gpu: 83, heartbeat: '5 sec ago', priority: 1,
                    url: 'http://192.168.1.101:8080', connectedTo: ['http://192.168.1.100:8080'], 
                    trainingRounds: 245, accuracy: 95.2, loss: 0.048,
                    stats: { cpuHistory: [65, 68, 70, 68], gpuHistory: [80, 83, 85, 83], accuracyHistory: [92.1, 93.5, 94.8, 95.2] }
                },
                { 
                    id: 'edge-3', name: 'Training Node 03', status: 'training', progress: 64, cpu: 85, memory: '1.5GB', gpu: 92, heartbeat: '1 sec ago', priority: 2,
                    url: 'http://192.168.1.103:8080', connectedTo: ['http://192.168.1.100:8080'], 
                    trainingRounds: 160, accuracy: 88.7, loss: 0.089,
                    stats: { cpuHistory: [80, 85, 87, 85], gpuHistory: [88, 92, 94, 92], accuracyHistory: [85.2, 86.8, 87.9, 88.7] }
                },
                { 
                    id: 'edge-5', name: 'Training Node 05', status: 'training', progress: 83, cpu: 75, memory: '2.3GB', gpu: 88, heartbeat: '3 sec ago', priority: 3,
                    url: 'http://192.168.1.105:8080', connectedTo: ['http://192.168.1.101:8080'], 
                    trainingRounds: 208, accuracy: 91.3, loss: 0.065,
                    stats: { cpuHistory: [72, 75, 78, 75], gpuHistory: [85, 88, 90, 88], accuracyHistory: [88.5, 89.8, 90.6, 91.3] }
                },
                { 
                    id: 'edge-8', name: 'Training Node 08', status: 'training', progress: 56, cpu: 90, memory: '2.8GB', gpu: 95, heartbeat: '1 sec ago', priority: 4,
                    url: 'http://192.168.1.108:8080', connectedTo: ['http://192.168.1.101:8080'], 
                    trainingRounds: 140, accuracy: 84.1, loss: 0.125,
                    stats: { cpuHistory: [88, 90, 92, 90], gpuHistory: [92, 95, 97, 95], accuracyHistory: [80.5, 82.1, 83.5, 84.1] }
                },
                { 
                    id: 'edge-9', name: 'Training Node 09', status: 'training', progress: 72, cpu: 82, memory: '1.9GB', gpu: 78, heartbeat: '2 sec ago', priority: 5,
                    url: 'http://192.168.1.109:8080', connectedTo: ['http://192.168.1.102:8080'], 
                    trainingRounds: 180, accuracy: 89.5, loss: 0.078,
                    stats: { cpuHistory: [78, 82, 85, 82], gpuHistory: [75, 78, 80, 78], accuracyHistory: [86.2, 87.8, 88.9, 89.5] }
                },
                { 
                    id: 'edge-11', name: 'Training Node 11', status: 'training', progress: 89, cpu: 78, memory: '2.2GB', gpu: 85, heartbeat: '1 sec ago', priority: 6,
                    url: 'http://192.168.1.111:8080', connectedTo: ['http://192.168.1.100:8080'], 
                    trainingRounds: 222, accuracy: 92.7, loss: 0.055,
                    stats: { cpuHistory: [75, 78, 80, 78], gpuHistory: [82, 85, 88, 85], accuracyHistory: [89.1, 90.8, 91.9, 92.7] }
                },
                { 
                    id: 'edge-13', name: 'Training Node 13', status: 'training', progress: 42, cpu: 92, memory: '3.1GB', gpu: 89, heartbeat: '2 sec ago', priority: 7,
                    url: 'http://192.168.1.113:8080', connectedTo: ['http://192.168.1.101:8080'], 
                    trainingRounds: 105, accuracy: 78.3, loss: 0.187,
                    stats: { cpuHistory: [89, 92, 95, 92], gpuHistory: [86, 89, 91, 89], accuracyHistory: [74.5, 76.2, 77.8, 78.3] }
                },
                { 
                    id: 'edge-14', name: 'Training Node 14', status: 'training', progress: 38, cpu: 87, memory: '2.7GB', gpu: 91, heartbeat: '1 sec ago', priority: 8,
                    url: 'http://192.168.1.114:8080', connectedTo: ['http://192.168.1.102:8080'], 
                    trainingRounds: 95, accuracy: 75.8, loss: 0.205,
                    stats: { cpuHistory: [84, 87, 90, 87], gpuHistory: [88, 91, 93, 91], accuracyHistory: [72.1, 73.7, 74.9, 75.8] }
                },
                // Idle nodes waiting for training
                { id: 'edge-4', name: 'Training Node 04', status: 'idle', progress: 0, cpu: 15, memory: '0.8GB', gpu: 0, heartbeat: '10 sec ago', priority: 9 },
                { id: 'edge-10', name: 'Training Node 10', status: 'idle', progress: 0, cpu: 12, memory: '0.6GB', gpu: 0, heartbeat: '8 sec ago', priority: 10 },
                { id: 'edge-15', name: 'Training Node 15', status: 'idle', progress: 0, cpu: 8, memory: '1.1GB', gpu: 0, heartbeat: '15 sec ago', priority: 11 },
                { id: 'edge-16', name: 'Training Node 16', status: 'idle', progress: 0, cpu: 22, memory: '1.3GB', gpu: 0, heartbeat: '12 sec ago', priority: 12 },
                // Completed nodes (will gradually fade out)
                { 
                    id: 'edge-2', name: 'Training Node 02', status: 'completed', progress: 100, cpu: 45, memory: '2.1GB', gpu: 0, heartbeat: '2 sec ago', priority: 13, fadeOut: true,
                    url: 'http://192.168.1.102:8080', connectedTo: ['http://192.168.1.100:8080'], 
                    trainingRounds: 300, accuracy: 96.8, loss: 0.032,
                    stats: { 
                        cpuHistory: [85, 72, 58, 45], 
                        gpuHistory: [92, 78, 45, 0], 
                        accuracyHistory: [91.2, 94.5, 95.8, 96.8] 
                    }
                },
                { 
                    id: 'edge-7', name: 'Training Node 07', status: 'completed', progress: 100, cpu: 25, memory: '1.2GB', gpu: 0, heartbeat: '4 sec ago', priority: 14, fadeOut: true,
                    url: 'http://192.168.1.107:8080', connectedTo: ['http://192.168.1.101:8080'], 
                    trainingRounds: 280, accuracy: 94.2, loss: 0.041,
                    stats: { 
                        cpuHistory: [78, 65, 42, 25], 
                        gpuHistory: [88, 65, 30, 0], 
                        accuracyHistory: [87.5, 90.8, 92.6, 94.2] 
                    }
                },
                { 
                    id: 'edge-12', name: 'Training Node 12', status: 'completed', progress: 100, cpu: 35, memory: '1.4GB', gpu: 0, heartbeat: '5 sec ago', priority: 15, fadeOut: true,
                    url: 'http://192.168.1.112:8080', connectedTo: ['http://192.168.1.102:8080'], 
                    trainingRounds: 320, accuracy: 97.3, loss: 0.028,
                    stats: { 
                        cpuHistory: [82, 68, 52, 35], 
                        gpuHistory: [90, 75, 48, 0], 
                        accuracyHistory: [89.7, 93.1, 95.4, 97.3] 
                    }
                },
                // Error nodes
                { id: 'edge-6', name: 'Training Node 06', status: 'error', progress: 23, cpu: 0, memory: '0GB', gpu: 0, heartbeat: '2 min ago', priority: 16, fadeOut: true },
                // More nodes...
                { id: 'edge-17', name: 'Training Node 17', status: 'training', progress: 15, cpu: 95, memory: '2.9GB', gpu: 93, heartbeat: '1 sec ago', priority: 17 },
                { id: 'edge-18', name: 'Training Node 18', status: 'idle', progress: 0, cpu: 18, memory: '1.5GB', gpu: 0, heartbeat: '20 sec ago', priority: 18 },
                { id: 'edge-19', name: 'Training Node 19', status: 'training', progress: 67, cpu: 88, memory: '2.4GB', gpu: 86, heartbeat: '3 sec ago', priority: 19 },
                { id: 'edge-20', name: 'Training Node 20', status: 'idle', progress: 0, cpu: 25, memory: '1.7GB', gpu: 0, heartbeat: '18 sec ago', priority: 20 }
            ],
            // Currently displayed nodes in visualization interface (max 15)
            edgeNodes: []
        };
        
        let selectedNode = null;
        let animationId = null;
        let nodePositions = []; // Predefined node positions
        
        // Sorting related variables
        let currentSortField = 'priority';
        let currentSortDirection = 'asc';
        
        // Predefined visualization node positions (max 15 positions)
        function initializeNodePositions() {
            nodePositions = [
                { x: 120, y: 280 }, { x: 200, y: 320 }, { x: 280, y: 360 }, { x: 360, y: 320 }, { x: 440, y: 280 },
                { x: 520, y: 320 }, { x: 600, y: 360 }, { x: 680, y: 320 }, { x: 160, y: 440 }, { x: 320, y: 480 },
                { x: 480, y: 440 }, { x: 640, y: 480 }, { x: 240, y: 520 }, { x: 400, y: 540 }, { x: 560, y: 520 }
            ];
        }
        
        // 动态管理可视化节点：只显示训练中的节点
        function updateVisualizedNodes() {
            // 确保nodePositions已初始化
            if (!nodePositions || nodePositions.length === 0) {
                initializeNodePositions();
            }
            
            // 只选择训练中的节点进行可视化
            const trainingNodes = networkData.allEdgeNodes.filter(node => node.status === 'training');
            
            // 按CPU使用率排序（高的优先显示）
            const sortedTrainingNodes = trainingNodes.sort((a, b) => b.cpu - a.cpu);
            
            // 选择前15个训练中的节点用于可视化，为它们分配位置
            const newVisualizedNodes = sortedTrainingNodes.slice(0, 15).map((node, index) => {
                const position = nodePositions[index] || { x: 200 + (index * 60), y: 200 + (Math.floor(index / 5) * 80) };
                return {
                    ...node,
                    x: position.x,
                    y: position.y,
                    visualIndex: index
                };
            });
            
            // 检查节点变化，添加淡入淡出动画
            const oldIds = networkData.edgeNodes.map(n => n.id);
            const newIds = newVisualizedNodes.map(n => n.id);
            
            // 标记淡出的节点
            networkData.edgeNodes.forEach(node => {
                if (!newIds.includes(node.id)) {
                    node.fadeOut = true;
                }
            });
            
            // 标记淡入的节点
            newVisualizedNodes.forEach(node => {
                if (!oldIds.includes(node.id)) {
                    node.fadeIn = true;
                }
            });
            
            // 更新可视化节点列表
            networkData.edgeNodes = newVisualizedNodes;
        }
        
        // 模拟项目数据（根据项目ID获取不同数据）
        const projectsData = {
            1: {
                name: 'Smart Manufacturing Monitoring System',
                description: 'EdgeAI-based factory equipment real-time monitoring and predictive maintenance system for intelligent equipment status analysis and fault warning.',
                status: 'training',
                created: '2024-01-15',
                updated: '2 hours ago',
                progress: 75,
                aiModel: 'gemma',
                strategy: 'dpo',
                protocol: 'fedavg',
                targetAccuracy: '≥90%',
                estimatedTime: '2 days'
            },
            2: {
                name: 'Smart City Traffic Optimization',
                description: 'EdgeAI technology for real-time urban traffic flow analysis, intelligent traffic light control and route optimization recommendation system.',
                status: 'active',
                created: '2024-02-10',
                updated: '30 minutes ago',
                progress: 45,
                aiModel: 'RNN Recurrent Neural Network',
                strategy: 'Reinforcement Learning',
                protocol: 'fedavg',
                targetAccuracy: '≥85%', 
                estimatedTime: '5 days',
                
            },
            3: {
                name: 'Medical Image Intelligent Diagnosis',
                description: 'Deep learning-based medical image automatic recognition and diagnostic assistance system to improve diagnostic accuracy and efficiency.',
                status: 'completed',
                created: '2024-01-20',
                updated: '1 day ago',
                progress: 100,
                aiModel: 'ResNet Deep Residual Network',
                strategy: 'Transfer Learning',
                protocol: 'fedavg',
                targetAccuracy: '≥95%',
                estimatedTime: 'Completed'
            }
        };
        
        // 初始化项目信息
        function initializeProjectInfo() {
            const project = projectsData[projectId] || projectsData[1];
            
            // 更新项目基本信息
            document.getElementById('projectTitle').textContent = project.name;
            document.getElementById('projectDescription').textContent = project.description;
            document.getElementById('projectCreated').textContent = project.created;
            document.getElementById('projectUpdated').textContent = project.updated;
            
            // 更新状态
            const statusElement = document.getElementById('projectStatus');
            const statusColors = {
                'training': { color: 'text-blue-600', text: 'Training', bgColor: 'bg-blue-500' },
                'active': { color: 'text-green-600', text: 'Running', bgColor: 'bg-green-500' },
                'completed': { color: 'text-green-600', text: 'Completed', bgColor: 'bg-green-500' },
                'paused': { color: 'text-yellow-600', text: 'Paused', bgColor: 'bg-yellow-500' },
                'error': { color: 'text-red-600', text: 'Error', bgColor: 'bg-red-500' }
            };
            
            const statusInfo = statusColors[project.status] || statusColors['training'];
            statusElement.className = `font-semibold ml-2 ${statusInfo.color}`;
            statusElement.textContent = statusInfo.text;
            
            // 更新状态指示器
            const statusDot = document.getElementById('statusDot');
            statusDot.className = `w-2 h-2 rounded-full mr-2 flex-shrink-0 ${statusInfo.bgColor}`;
            
            // 更新进度圆环
            const progressCircle = document.getElementById('progressCircle');
            const circumference = 2 * Math.PI * 40; // r=40
            const offset = circumference - (project.progress / 100) * circumference;
            progressCircle.style.strokeDashoffset = offset;
            document.getElementById('overallProgress').textContent = `${project.progress}%`;
            
            // 更新进度条
            const progressBar = document.getElementById('overallProgressBar');
            if (progressBar) {
                progressBar.style.width = `${project.progress}%`;
                
                // 根据进度改变进度条颜色
                if (project.progress < 30) {
                    progressBar.className = 'bg-gradient-to-r from-red-500 via-orange-500 to-yellow-500 h-3 rounded-full transition-all duration-1000 ease-out relative overflow-hidden';
                } else if (project.progress < 70) {
                    progressBar.className = 'bg-gradient-to-r from-yellow-500 via-blue-500 to-blue-600 h-3 rounded-full transition-all duration-1000 ease-out relative overflow-hidden';
                } else {
                    progressBar.className = 'bg-gradient-to-r from-blue-500 via-blue-600 to-green-500 h-3 rounded-full transition-all duration-1000 ease-out relative overflow-hidden';
                }
                
                // 重新添加光效元素
                progressBar.innerHTML = '<div class="absolute top-0 -inset-full h-full bg-gradient-to-r from-transparent via-white to-transparent opacity-30 animate-shimmer"></div>';
            }
            
            // Update training rounds information
            const progressDetails = document.getElementById('progressDetails');
            if (progressDetails) {
                const currentRounds = Math.floor((project.progress / 100) * 250);
                progressDetails.textContent = `Round ${currentRounds}/250`;
            }
            
            // 更新阶段指示器
            const stage1 = document.getElementById('stage1');
            const stage2 = document.getElementById('stage2');
            const stage3 = document.getElementById('stage3');
            
            if (stage1 && stage2 && stage3) {
                // 重置所有阶段
                [stage1, stage2, stage3].forEach(stage => {
                    stage.classList.remove('active');
                });
                
                // 根据进度激活对应阶段
                if (project.progress < 5) {
                    stage1.classList.add('active');
                } else if (project.progress < 95) {
                    stage2.classList.add('active');
                } else {
                    stage3.classList.add('active');
                }
            }
            
            // 更新快速统计
            const totalNodes = networkData.controlNodes.length + networkData.edgeNodes.length;
            const onlineNodes = networkData.edgeNodes.filter(n => n.status !== 'error').length + networkData.controlNodes.length;
            const trainingNodes = networkData.edgeNodes.filter(n => n.status === 'training').length;
            
            document.getElementById('quickNodeCount').textContent = totalNodes;
            document.getElementById('quickOnlineCount').textContent = onlineNodes;
            document.getElementById('quickTrainingCount').textContent = trainingNodes;
            
            // 更新项目配置
            document.getElementById('aiModelType').textContent = project.aiModel;
            document.getElementById('trainingStrategy').textContent = project.strategy;
            document.getElementById('targetAccuracy').textContent = project.targetAccuracy;
            document.getElementById('estimatedTime').textContent = project.estimatedTime;
        }
        
        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('projectName').textContent = `- 项目 ${projectId}`;
            initializeProjectInfo(); // 初始化项目信息
            initializeVisualization();
            startRealTimeUpdates();
        });
        
        // 冻结节点位置，防止意外修改
        function freezeNodePositions() {
            networkData.controlNodes.forEach(node => {
                const originalX = node.x;
                const originalY = node.y;
                Object.defineProperty(node, 'x', { 
                    value: originalX, 
                    writable: false, 
                    configurable: false 
                });
                Object.defineProperty(node, 'y', { 
                    value: originalY, 
                    writable: false, 
                    configurable: false 
                });
            });
            
            networkData.edgeNodes.forEach(node => {
                const originalX = node.x;
                const originalY = node.y;
                Object.defineProperty(node, 'x', { 
                    value: originalX, 
                    writable: false, 
                    configurable: false 
                });
                Object.defineProperty(node, 'y', { 
                    value: originalY, 
                    writable: false, 
                    configurable: false 
                });
            });
        }

        // 初始化可视化
        function initializeVisualization() {
            const svg = document.getElementById('networkSvg');
            initializeNodePositions(); // 首先初始化节点位置
            updateVisualizedNodes(); // 初始化可视化节点
            freezeNodePositions(); // 冻结节点位置
            drawNodes();
            drawConnections();
            updateStats();
            fillNodeTables(); // 填充节点表格
        }
        
        // 绘制节点
        function drawNodes() {
            const nodesGroup = document.getElementById('nodes');
            const labelsGroup = document.getElementById('labels');
            
            // 清空现有节点
            nodesGroup.innerHTML = '';
            labelsGroup.innerHTML = '';
            
            // 绘制控制节点
            networkData.controlNodes.forEach(node => {
                // 节点圆圈
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', node.x);
                circle.setAttribute('cy', node.y);
                circle.setAttribute('r', 25);
                circle.setAttribute('class', 'control-node');
                circle.setAttribute('data-id', node.id);
                
                // 设置每个节点的独特颜色
                console.log(`EdgeAI设置控制节点 ${node.id} 颜色: fill=${node.color.fill}, stroke=${node.color.stroke}`);
                circle.style.setProperty('fill', node.color.fill, 'important');
                circle.style.setProperty('stroke', node.color.stroke, 'important');
                circle.style.setProperty('stroke-width', '3px', 'important');
                circle.style.transition = 'all 0.3s ease';
                
                circle.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    showNodeDetails(node, 'control');
                });
                
                // 鼠标悬停效果
                circle.addEventListener('mouseenter', () => {
                    circle.style.setProperty('stroke-width', '4px', 'important');
                    circle.style.transform = 'scale(1.1)';
                    circle.style.filter = 'drop-shadow(0 4px 8px rgba(0,0,0,0.2))';
                });
                
                circle.addEventListener('mouseleave', () => {
                    circle.style.setProperty('stroke-width', '3px', 'important');
                    circle.style.transform = 'scale(1)';
                    circle.style.filter = 'none';
                });
                
                circle.style.pointerEvents = 'auto';
                circle.style.cursor = 'pointer';
                nodesGroup.appendChild(circle);
                
                // 节点标签
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', node.x);
                label.setAttribute('y', node.y - 35);
                label.setAttribute('class', 'node-label');
                label.textContent = node.name;
                labelsGroup.appendChild(label);
                
                // 移除状态指示器小圆点 - 保持节点简洁
            });
            
            // 绘制边缘节点
            networkData.edgeNodes.forEach(node => {
                // 节点圆圈
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', node.x);
                circle.setAttribute('cy', node.y);
                circle.setAttribute('r', 18);
                
                let nodeClass = `edge-node ${node.status}`;
                
                // 为训练中的节点添加颜色呼吸效果
                if (node.status === 'training') {
                    nodeClass += ' breathing';
                }
                
                // 添加动画效果
                if (node.fadeIn) {
                    nodeClass += ' node-fade-in';
                    // 清除标记
                    setTimeout(() => {
                        node.fadeIn = false;
                    }, 600);
                }
                if (node.fadeOut) {
                    nodeClass += ' node-fade-out';
                    // 清除淡出标记
                    setTimeout(() => {
                        node.fadeOut = false;
                    }, 400);
                }
                
                circle.setAttribute('class', nodeClass);
                circle.setAttribute('data-id', node.id);
                circle.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    showNodeDetails(node, 'edge');
                });
                // 确保节点不会被拖拽或移动
                circle.style.pointerEvents = 'auto';
                circle.style.cursor = 'pointer';
                nodesGroup.appendChild(circle);
                
                // 进度环
                if (node.status === 'training' && node.progress > 0) {
                    const progressCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    progressCircle.setAttribute('cx', node.x);
                    progressCircle.setAttribute('cy', node.y);
                    progressCircle.setAttribute('r', 15);
                    progressCircle.setAttribute('class', 'progress-ring active');
                    progressCircle.setAttribute('stroke-dasharray', '94.2');
                    progressCircle.setAttribute('stroke-dashoffset', 94.2 * (1 - node.progress / 100));
                    nodesGroup.appendChild(progressCircle);
                }
                
                // 节点标签
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', node.x);
                label.setAttribute('y', node.y + 35);
                label.setAttribute('class', 'node-label');
                label.textContent = node.name;
                labelsGroup.appendChild(label);
                
                // 进度文字
                if (node.status === 'training') {
                    const progressText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    progressText.setAttribute('x', node.x);
                    progressText.setAttribute('y', node.y + 3);
                    progressText.setAttribute('class', 'node-label');
                    progressText.setAttribute('font-size', '10');
                    progressText.textContent = `${node.progress}%`;
                    labelsGroup.appendChild(progressText);
                }
            });
        }
        
        // 绘制连接线
        function drawConnections() {
            const connectionsGroup = document.getElementById('connections');
            connectionsGroup.innerHTML = '';
            
            // 为每个边缘节点分配控制节点（实际网络连接逻辑）
            networkData.edgeNodes.forEach((edgeNode, index) => {
                // 只为训练中和未完成的节点绘制连接线
                if (edgeNode.status === 'completed') {
                    return; // 跳过已完成的节点
                }
                
                // 根据节点索引分配控制节点（模拟实际网络连接）
                let controlNodeIndex = 0; // 默认连接到主控节点1
                
                // 简单的负载均衡分配逻辑
                if (index < 4) {
                    controlNodeIndex = 0; // 前4个节点连接到主控节点1
                } else if (index < 8) {
                    controlNodeIndex = 1; // 中间4个节点连接到主控节点2  
                } else {
                    controlNodeIndex = 2; // 剩余节点连接到备用控制节点
                }
                
                // 确保控制节点存在
                if (controlNodeIndex < networkData.controlNodes.length) {
                    const controlNode = networkData.controlNodes[controlNodeIndex];
                    
                    // 创建连接线
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', controlNode.x);
                    line.setAttribute('y1', controlNode.y);
                    line.setAttribute('x2', edgeNode.x);
                    line.setAttribute('y2', edgeNode.y);
                    
                    // 连接线默认透明，等待数据传输触发
                    let lineClass = 'connection-line';
                    
                    line.setAttribute('class', lineClass);
                    line.setAttribute('data-from', controlNode.id);
                    line.setAttribute('data-to', edgeNode.id);
                    line.setAttribute('data-status', edgeNode.status);
                    
                    connectionsGroup.appendChild(line);
                }
            });
        }
        
        // 通过节点ID打开节点详情
        function openNodeDetails(nodeId) {
            console.log('Opening node details for:', nodeId);
            const node = networkData.allEdgeNodes.find(n => n.id === nodeId);
            if (node) {
                console.log('Found node:', node);
                showNodeModal(node);
            } else {
                console.log('Node not found:', nodeId);
            }
        }

        // 显示新的模态卡片
        function showNodeModal(node) {
            const modal = document.getElementById('nodeModal');
            
            // 填充基础信息
            document.getElementById('modalNodeTitle').textContent = node.name;
            document.getElementById('modalNodeStatus').textContent = getStatusText(node.status);
            document.getElementById('modalNodeName').textContent = node.name;
            document.getElementById('modalNodeUrl').textContent = node.url || '未配置';
            document.getElementById('modalTrainingRounds').textContent = node.trainingRounds || 0;
            document.getElementById('modalProgress').textContent = `${node.progress}%`;
            document.getElementById('modalProgressBar').style.width = `${node.progress}%`;
            document.getElementById('modalHeartbeat').textContent = node.heartbeat || '未知';
            
            // 填充连接节点信息
            const connectedNodesDiv = document.getElementById('modalConnectedNodes');
            connectedNodesDiv.innerHTML = '';
            if (node.connectedTo && node.connectedTo.length > 0) {
                node.connectedTo.forEach(url => {
                    const nodeDiv = document.createElement('div');
                    nodeDiv.className = 'flex items-center space-x-2 bg-white px-3 py-2 rounded border';
                    nodeDiv.innerHTML = `
                        <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                        <span class="font-mono text-sm">${url}</span>
                        <div class="ml-auto text-xs text-green-600">已连接</div>
                    `;
                    connectedNodesDiv.appendChild(nodeDiv);
                });
            } else {
                connectedNodesDiv.innerHTML = '<div class="text-gray-500 text-sm">无连接</div>';
            }
            
            // 填充资源使用情况
            document.getElementById('modalCpuValue').textContent = `${node.cpu.toFixed(2)}%`;
            document.getElementById('modalCpuBar').style.width = `${node.cpu}%`;
            document.getElementById('modalGpuValue').textContent = `${node.gpu.toFixed(2)}%`;
            document.getElementById('modalGpuBar').style.width = `${node.gpu}%`;
            document.getElementById('modalMemoryValue').textContent = node.memory || 'Unknown';
            
            // If it's a training node or a node that has completed training, show training statistics
            const trainingStatsDiv = document.getElementById('modalTrainingStats');
            if ((node.status === 'training' || node.status === 'completed') && node.accuracy && node.loss) {
                trainingStatsDiv.style.display = 'block';
                
                // Update titles and labels based on node status
                const statsTitle = document.getElementById('modalTrainingStatsTitle');
                const accuracyLabel = document.getElementById('modalAccuracyLabel');
                const lossLabel = document.getElementById('modalLossLabel');
                const chartTitle = document.getElementById('modalChartTitle');
                
                if (node.status === 'completed') {
                    statsTitle.textContent = 'Historical Training Results';
                    accuracyLabel.textContent = 'Final Accuracy';
                    lossLabel.textContent = 'Final Loss Value';
                    chartTitle.textContent = 'Training Process Curve';
                } else {
                    statsTitle.textContent = 'Training Statistics';
                    accuracyLabel.textContent = 'Current Accuracy';
                    lossLabel.textContent = 'Current Loss Value';
                    chartTitle.textContent = 'Accuracy History Trend';
                }
                
                document.getElementById('modalAccuracy').textContent = `${node.accuracy.toFixed(2)}%`;
                document.getElementById('modalLoss').textContent = node.loss.toFixed(2);
                
                // Show historical trend curves
                if (node.stats && node.stats.accuracyHistory && node.stats.accuracyHistory.length > 1) {
                    const chartSvg = document.getElementById('modalAccuracyChart');
                    const svgRect = chartSvg.getBoundingClientRect();
                    const width = svgRect.width || 280;
                    const height = svgRect.height || 60;
                    const padding = 10;
                    const chartWidth = width - 2 * padding;
                    const chartHeight = height - 2 * padding;
                    
                    // Clear SVG
                    chartSvg.innerHTML = '';
                    
                    const accuracyData = node.stats.accuracyHistory;
                    const rounds = accuracyData.length;
                    const maxAccuracy = Math.max(...accuracyData);
                    const minAccuracy = Math.min(...accuracyData);
                    const accuracyRange = maxAccuracy - minAccuracy || 10; // 避免除以0
                    
                    // 计算点的坐标
                    const points = accuracyData.map((accuracy, index) => {
                        const x = padding + (index / (rounds - 1)) * chartWidth;
                        const y = padding + ((maxAccuracy - accuracy) / accuracyRange) * chartHeight;
                        return { x, y, accuracy, round: index + 1 };
                    });
                    
                    // 创建路径字符串
                    let pathD = `M ${points[0].x} ${points[0].y}`;
                    for (let i = 1; i < points.length; i++) {
                        // 使用贝塞尔曲线创建平滑曲线
                        const prevPoint = points[i - 1];
                        const currentPoint = points[i];
                        const controlPointX1 = prevPoint.x + (currentPoint.x - prevPoint.x) / 3;
                        const controlPointY1 = prevPoint.y;
                        const controlPointX2 = currentPoint.x - (currentPoint.x - prevPoint.x) / 3;
                        const controlPointY2 = currentPoint.y;
                        
                        pathD += ` C ${controlPointX1} ${controlPointY1}, ${controlPointX2} ${controlPointY2}, ${currentPoint.x} ${currentPoint.y}`;
                    }
                    
                    // 创建渐变定义
                    const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
                    const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
                    gradient.setAttribute('id', 'accuracyGradient');
                    gradient.setAttribute('x1', '0%');
                    gradient.setAttribute('y1', '0%');
                    gradient.setAttribute('x2', '0%');
                    gradient.setAttribute('y2', '100%');
                    
                    const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
                    stop1.setAttribute('offset', '0%');
                    stop1.setAttribute('style', 'stop-color:rgb(34,197,94);stop-opacity:0.8');
                    
                    const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
                    stop2.setAttribute('offset', '100%');
                    stop2.setAttribute('style', 'stop-color:rgb(34,197,94);stop-opacity:0.1');
                    
                    gradient.appendChild(stop1);
                    gradient.appendChild(stop2);
                    defs.appendChild(gradient);
                    chartSvg.appendChild(defs);
                    
                    // 创建填充区域路径
                    const fillPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const fillPathD = pathD + ` L ${points[points.length - 1].x} ${height - padding} L ${points[0].x} ${height - padding} Z`;
                    fillPath.setAttribute('d', fillPathD);
                    fillPath.setAttribute('fill', 'url(#accuracyGradient)');
                    chartSvg.appendChild(fillPath);
                    
                    // 创建曲线路径
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    path.setAttribute('d', pathD);
                    path.setAttribute('stroke', 'rgb(34,197,94)');
                    path.setAttribute('stroke-width', '2');
                    path.setAttribute('fill', 'none');
                    path.setAttribute('stroke-linecap', 'round');
                    path.setAttribute('stroke-linejoin', 'round');
                    chartSvg.appendChild(path);
                    
                    // 添加数据点
                    points.forEach((point, index) => {
                        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                        circle.setAttribute('cx', point.x);
                        circle.setAttribute('cy', point.y);
                        circle.setAttribute('r', '3');
                        circle.setAttribute('fill', 'rgb(34,197,94)');
                        circle.setAttribute('stroke', 'white');
                        circle.setAttribute('stroke-width', '1');
                        
                        // 添加hover效果
                        circle.addEventListener('mouseover', function() {
                            circle.setAttribute('r', '5');
                            // 可以添加tooltip显示具体数值
                        });
                        circle.addEventListener('mouseout', function() {
                            circle.setAttribute('r', '3');
                        });
                        
                        chartSvg.appendChild(circle);
                    });
                    
                    // 更新轮次显示
                    const currentRound = (node.trainingRounds || 0) - rounds + 1;
                    document.getElementById('modalRoundStart').textContent = `轮次 ${Math.max(1, currentRound)}`;
                    document.getElementById('modalRoundEnd').textContent = `轮次 ${node.trainingRounds || rounds}`;
                    document.getElementById('modalAccuracyHistory').textContent = 
                        `历史准确率: ${accuracyData.map(acc => acc.toFixed(2)).join('% → ')}%`;
                } else {
                    // 如果没有历史数据，显示占位内容
                    const chartSvg = document.getElementById('modalAccuracyChart');
                    chartSvg.innerHTML = '<text x="50%" y="50%" text-anchor="middle" fill="#9CA3AF" font-size="12">暂无历史数据</text>';
                    document.getElementById('modalRoundStart').textContent = '轮次';
                    document.getElementById('modalRoundEnd').textContent = '当前';
                    document.getElementById('modalAccuracyHistory').textContent = '暂无历史数据';
                }
            } else {
                trainingStatsDiv.style.display = 'none';
            }
            
            // 根据节点状态控制按钮显示
            const stopBtn = document.getElementById('stopTrainingBtn');
            const restartBtn = document.getElementById('restartTrainingBtn');
            const exportBtn = document.getElementById('exportResultBtn');
            
            if (node.status === 'completed') {
                stopBtn.style.display = 'none';
                restartBtn.textContent = '重新训练';
                exportBtn.style.display = 'inline-block';
            } else if (node.status === 'training') {
                stopBtn.style.display = 'inline-block';
                restartBtn.textContent = '重启训练';
                restartBtn.style.display = 'inline-block';
                exportBtn.style.display = 'none';
            } else {
                stopBtn.style.display = 'none';
                restartBtn.textContent = '开始训练';
                restartBtn.style.display = 'inline-block';
                exportBtn.style.display = 'none';
            }
            
            // 显示模态框
            modal.classList.add('show');
        }

        // Close modal card
        function closeNodeModal() {
            const modal = document.getElementById('nodeModal');
            modal.classList.remove('show');
        }

        // Get status text
        function getStatusText(status) {
            const statusMap = {
                'training': 'Training',
                'completed': 'Training Complete',
                'idle': 'Idle Standby',
                'error': 'Error Status'
            };
            return statusMap[status] || 'Unknown Status';
        }

        // Stop training function
        function stopTraining() {
            alert('Stop training feature not yet implemented');
        }

        // Restart training function
        function restartTraining() {
            alert('Restart training feature not yet implemented');
        }

        // Export training results function
        function exportTrainingResult() {
            if (!selectedNode) {
                alert('No node selected');
                return;
            }
            
            const result = {
                nodeInfo: {
                    name: selectedNode.name,
                    url: selectedNode.url,
                    status: selectedNode.status
                },
                trainingResults: {
                    totalRounds: selectedNode.trainingRounds || 0,
                    finalAccuracy: selectedNode.accuracy ? selectedNode.accuracy.toFixed(2) : 'N/A',
                    finalLoss: selectedNode.loss ? selectedNode.loss.toFixed(2) : 'N/A',
                    progress: selectedNode.progress
                },
                historyData: selectedNode.stats || {}
            };
            
            // Create JSON file and download
            const dataStr = JSON.stringify(result, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `${selectedNode.name}_training_results_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert(`${selectedNode.name} 的训练结果已导出！\n\n包含信息:\n- 节点基础信息\n- 最终训练结果\n- 历史数据记录`);
        }

        // ========== 邀请用户模态卡片功能 ==========
        
        function showInviteUserModal() {
            const modal = document.getElementById('inviteUserModal');
            modal.classList.add('show');
        }
        
        function closeInviteUserModal() {
            const modal = document.getElementById('inviteUserModal');
            modal.classList.remove('show');
            // 清空表单
            clearInviteForm();
        }
        
        // 邮箱列表管理
        let inviteEmailList = [];
        
        function addEmailToList() {
            const emailInput = document.getElementById('inviteEmail');
            const email = emailInput.value.trim();
            
            if (!email) {
                alert('请输入邮箱地址');
                return;
            }
            
            // 简单的邮箱验证
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                alert('请输入有效的邮箱地址');
                return;
            }
            
            // 检查是否已存在
            if (inviteEmailList.includes(email)) {
                alert('该邮箱已在列表中');
                return;
            }
            
            inviteEmailList.push(email);
            updateInviteEmailList();
            emailInput.value = '';
        }
        
        function removeEmailFromList(email) {
            inviteEmailList = inviteEmailList.filter(e => e !== email);
            updateInviteEmailList();
        }
        
        function updateInviteEmailList() {
            const listDiv = document.getElementById('inviteEmailList');
            
            if (inviteEmailList.length === 0) {
                listDiv.innerHTML = '<div class="text-gray-500 text-sm">暂无待邀请用户</div>';
                return;
            }
            
            listDiv.innerHTML = inviteEmailList.map(email => `
                <div class="flex items-center justify-between bg-blue-50 px-3 py-2 rounded-lg">
                    <span class="font-mono text-sm">${email}</span>
                    <button onclick="removeEmailFromList('${email}')" class="text-red-500 hover:text-red-700 ml-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `).join('');
        }
        
        function sendInvitations() {
            if (inviteEmailList.length === 0) {
                alert('Please add at least one email address');
                return;
            }
            
            const role = document.querySelector('input[name="userRole"]:checked').value;
            const message = document.getElementById('inviteMessage').value;
            
            // Simulate sending invitations
            alert(`Sending invitations to ${inviteEmailList.length} users...\n\nRole: ${role === 'participant' ? 'Participant' : 'Observer'}\nEmail list: ${inviteEmailList.join(', ')}`);
            
            // Close modal after successful sending
            setTimeout(() => {
                closeInviteUserModal();
                alert('Invitations sent successfully!');
            }, 1000);
        }
        
        function clearInviteForm() {
            inviteEmailList = [];
            updateInviteEmailList();
            document.getElementById('inviteEmail').value = '';
            document.getElementById('inviteMessage').value = 'Hello, I invite you to participate in our EdgeAI project. Looking forward to working with you!';
            document.querySelector('input[name="userRole"][value="participant"]').checked = true;
        }

        // ========== 添加节点模态卡片功能 ==========
        
        function showAddNodeModal() {
            const modal = document.getElementById('addNodeModal');
            modal.classList.add('show');
        }
        
        function closeAddNodeModal() {
            const modal = document.getElementById('addNodeModal');
            modal.classList.remove('show');
            // 清空表单
            clearAddNodeForm();
        }
        
        function testNodeConnection() {
            const address = document.getElementById('nodeAddress').value.trim();
            
            if (!address) {
                alert('请输入节点地址');
                return;
            }
            
            // 模拟连接测试
            alert('正在测试连接...');
            
            setTimeout(() => {
                const success = Math.random() > 0.3; // 70%成功率
                if (success) {
                    alert('连接测试成功！\n\n节点信息:\n- 响应时间: 25ms\n- 状态: 在线\n- 可用资源: 充足');
                } else {
                    alert('连接测试失败！\n\n可能原因:\n- 节点地址不正确\n- 节点未启动\n- 网络连接问题');
                }
            }, 1500);
        }
        
        function addNewNode() {
            const name = document.getElementById('nodeName').value.trim();
            const address = document.getElementById('nodeAddress').value.trim();
            const type = document.querySelector('input[name="nodeType"]:checked').value;
            const controlNode = document.getElementById('connectToControl').value;
            
            if (!name || !address) {
                alert('请填写节点名称和地址');
                return;
            }
            
            // 模拟添加节点
            const nodeInfo = {
                name,
                address,
                type: type === 'edge' ? '边缘节点' : type === 'control' ? '控制节点' : '观察节点',
                controlNode: controlNode || '无',
                cpuCores: document.getElementById('nodeCpuCores').value || '未指定',
                memory: document.getElementById('nodeMemory').value || '未指定',
                gpu: document.getElementById('nodeGpuType').value || '无',
                ssl: document.getElementById('enableSSL').checked,
                auth: document.getElementById('enableAuth').checked,
                monitoring: document.getElementById('enableMonitoring').checked
            };
            
            alert(`正在添加节点...\n\n节点信息:\n- 名称: ${nodeInfo.name}\n- 地址: ${nodeInfo.address}\n- 类型: ${nodeInfo.type}\n- 连接到: ${nodeInfo.controlNode}`);
            
            // 添加成功后关闭模态框
            setTimeout(() => {
                closeAddNodeModal();
                alert('节点添加成功！');
                // 这里可以添加实际的节点添加逻辑，更新网络数据
            }, 1500);
        }
        
        function clearAddNodeForm() {
            document.getElementById('nodeName').value = '';
            document.getElementById('nodeAddress').value = '';
            document.getElementById('connectToControl').value = '';
            document.getElementById('nodeCpuCores').value = '';
            document.getElementById('nodeMemory').value = '';
            document.getElementById('nodeGpuType').value = '';
            document.querySelector('input[name="nodeType"][value="edge"]').checked = true;
            document.getElementById('enableSSL').checked = true;
            document.getElementById('enableAuth').checked = true;
            document.getElementById('enableMonitoring').checked = true;
        }
        
        // 显示节点详情
        function showNodeDetails(node, type) {
            selectedNode = node;
            const detailsPanel = document.getElementById('nodeDetails');
            const nodeTitle = document.getElementById('nodeTitle');
            const nodeInfo = document.getElementById('nodeInfo');
            
            nodeTitle.textContent = `${node.name} - Details`;
            
            if (type === 'control') {
                nodeInfo.innerHTML = `
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Node Type</span>
                            <span class="font-semibold">Control Node</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Role</span>
                            <span class="font-semibold">Model Node</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Status</span>
                            <span class="font-semibold text-green-600">Online</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Responsible User</span>
                            <span class="font-semibold">${node.user}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">IP Address</span>
                            <span class="font-semibold text-xs">${node.ip}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Connected Nodes</span>
                            <span class="font-semibold">${networkData.edgeNodes.filter(n => n.status !== 'error').length}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Uptime</span>
                            <span class="font-semibold">15 days</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Version</span>
                            <span class="font-semibold">v2.1.0</span>
                        </div>
                    </div>
                `;
            } else {
                const statusColor = {
                    training: 'text-blue-600',
                    completed: 'text-green-600',
                    idle: 'text-gray-600',
                    error: 'text-red-600'
                }[node.status];
                
                const statusText = {
                    training: 'Training',
                    completed: 'Completed',
                    idle: 'Idle',
                    error: 'Error'
                }[node.status];
                
                nodeInfo.innerHTML = `
                    <div class="space-y-4">
                        <!-- 基础信息卡片 -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h5 class="font-semibold mb-3 text-blue-600">Basic Information</h5>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <span class="text-xs text-gray-600">Node Type</span>
                                    <div class="font-semibold">Edge Node</div>
                                </div>
                                <div>
                                    <span class="text-xs text-gray-600">Status</span>
                                    <div class="font-semibold ${statusColor}">${statusText}</div>
                                </div>
                                <div>
                                    <span class="text-xs text-gray-600">Training Progress</span>
                                    <div class="font-semibold text-blue-600">${node.progress}%</div>
                                </div>
                                <div>
                                    <span class="text-xs text-gray-600">Last Heartbeat</span>
                                    <div class="font-semibold">${node.heartbeat}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 网络信息卡片 -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h5 class="font-semibold mb-3 text-purple-600">Network Information</h5>
                            <div class="space-y-2">
                                <div>
                                    <span class="text-xs text-gray-600">Node Address</span>
                                    <div class="font-mono text-sm text-blue-600">${node.url || 'http://192.168.1.xxx:8080'}</div>
                                </div>
                                <div>
                                    <span class="text-xs text-gray-600">Connected Control Nodes</span>
                                    <div class="space-y-1">
                                        ${(node.connectedTo || ['http://192.168.1.100:8080']).map(url => 
                                            `<div class="font-mono text-sm text-green-600">${url}</div>`
                                        ).join('')}
                                    </div>
                                </div>
                                <div>
                                    <span class="text-xs text-gray-600">Network Speed</span>
                                    <div class="font-semibold">72Mbps</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 训练统计卡片 -->
                        ${node.status === 'training' && node.trainingRounds ? `
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h5 class="font-semibold mb-3 text-orange-600">Training Statistics</h5>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <span class="text-xs text-gray-600">Training Rounds</span>
                                    <div class="font-bold text-lg">${node.trainingRounds || 0}</div>
                                </div>
                                <div>
                                    <span class="text-xs text-gray-600">Current Accuracy</span>
                                    <div class="font-bold text-lg text-green-600">${(node.accuracy || 0).toFixed(2)}%</div>
                                </div>
                                <div>
                                    <span class="text-xs text-gray-600">Loss Value</span>
                                    <div class="font-bold text-lg text-red-600">${(node.loss || 0).toFixed(2)}</div>
                                </div>
                                <div>
                                    <span class="text-xs text-gray-600">Learning Rate</span>
                                    <div class="font-bold text-lg">0.001</div>
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- Resource Usage Card -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h5 class="font-semibold mb-3 text-red-600">Resource Usage</h5>
                            <div class="space-y-3">
                                <div>
                                    <div class="flex justify-between text-sm">
                                        <span>CPU Usage</span>
                                        <span class="font-semibold">${node.cpu.toFixed(2)}%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                        <div class="bg-blue-600 h-2 rounded-full" style="width: ${node.cpu}%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm">
                                        <span>GPU Usage</span>
                                        <span class="font-semibold">${node.gpu.toFixed(2)}%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                        <div class="bg-green-600 h-2 rounded-full" style="width: ${node.gpu}%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm">
                                        <span>Memory Usage</span>
                                        <span class="font-semibold">${node.memory}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Historical Trend Card -->
                        ${node.stats ? `
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h5 class="font-semibold mb-3 text-indigo-600">Trend Analysis</h5>
                            <div class="space-y-2">
                                <div>
                                    <span class="text-xs text-gray-600">Accuracy Trend</span>
                                    <div class="flex items-center space-x-1 mt-1">
                                        ${node.stats.accuracyHistory.map(acc => 
                                            `<div class="flex-1 bg-green-200 rounded h-3" style="height: ${(acc/100) * 20 + 5}px"></div>`
                                        ).join('')}
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">Last 4 rounds: ${node.stats.accuracyHistory.map(acc => acc.toFixed(2)).join(' → ')}%</div>
                                </div>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }
            
            detailsPanel.classList.add('show');
        }
        
        // 关闭节点详情
        function closeNodeDetails() {
            const detailsPanel = document.getElementById('nodeDetails');
            if (detailsPanel) {
                detailsPanel.classList.remove('show');
                selectedNode = null;
            }
        }
        
        // 添加点击外部关闭面板的功能
        document.addEventListener('click', function(e) {
            // 处理查看详情按钮点击
            if (e.target.classList.contains('node-details-btn')) {
                e.preventDefault();
                e.stopPropagation();
                const nodeId = e.target.getAttribute('data-node-id');
                console.log('Button clicked for node:', nodeId);
                openNodeDetails(nodeId);
                return;
            }
            
            // 处理模态框外部点击关闭
            const nodeModal = document.getElementById('nodeModal');
            const inviteModal = document.getElementById('inviteUserModal');
            const addNodeModal = document.getElementById('addNodeModal');
            
            if (nodeModal && nodeModal.classList.contains('show')) {
                // 如果点击的是模态框背景，关闭模态框
                if (e.target === nodeModal) {
                    closeNodeModal();
                }
            }
            
            if (inviteModal && inviteModal.classList.contains('show')) {
                if (e.target === inviteModal) {
                    closeInviteUserModal();
                }
            }
            
            if (addNodeModal && addNodeModal.classList.contains('show')) {
                if (e.target === addNodeModal) {
                    closeAddNodeModal();
                }
            }
            
            const nodeDetails = document.getElementById('nodeDetails');
            const controlPanel = document.querySelector('.control-panel');
            
            if (nodeDetails && nodeDetails.classList.contains('show')) {
                // 如果点击的不是节点详情面板内部、控制面板内部、或SVG节点
                if (!nodeDetails.contains(e.target) && 
                    !controlPanel.contains(e.target) && 
                    !e.target.closest('.edge-node') && 
                    !e.target.closest('.control-node')) {
                    closeNodeDetails();
                }
            }
        });
        
        // 更新统计信息
        function updateStats() {
            const trainingNodes = networkData.edgeNodes.filter(n => n.status === 'training').length;
            const totalProgress = networkData.edgeNodes.reduce((sum, n) => sum + n.progress, 0);
            const avgProgress = Math.floor(totalProgress / networkData.edgeNodes.length);
            
            document.getElementById('onlineNodes').textContent = networkData.edgeNodes.filter(n => n.status !== 'error').length;
            document.getElementById('trainingNodes').textContent = trainingNodes;
            document.getElementById('totalNodesCount').textContent = networkData.edgeNodes.length + networkData.controlNodes.length;
            document.getElementById('avgProgress').textContent = `${avgProgress}%`;
            
            // 更新平均进度条
            const avgProgressBar = document.getElementById('avgProgressBar');
            if (avgProgressBar) {
                avgProgressBar.style.width = `${avgProgress}%`;
                
                // 根据进度改变颜色
                if (avgProgress < 25) {
                    avgProgressBar.className = 'bg-gradient-to-r from-red-500 to-red-600 h-2 rounded-full transition-all duration-800 ease-out relative';
                } else if (avgProgress < 50) {
                    avgProgressBar.className = 'bg-gradient-to-r from-orange-500 to-yellow-500 h-2 rounded-full transition-all duration-800 ease-out relative';
                } else if (avgProgress < 75) {
                    avgProgressBar.className = 'bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all duration-800 ease-out relative';
                } else {
                    avgProgressBar.className = 'bg-gradient-to-r from-green-500 to-green-600 h-2 rounded-full transition-all duration-800 ease-out relative';
                }
                
                // 重新添加光效
                avgProgressBar.innerHTML = '<div class="absolute top-0 -inset-full h-full bg-gradient-to-r from-transparent via-white to-transparent opacity-40 animate-shimmer"></div>';
            }
            
            // 更新节点计数
            document.getElementById('controlNodeCount').textContent = networkData.controlNodes.length;
            document.getElementById('edgeNodeCount').textContent = networkData.edgeNodes.length;
            document.getElementById('totalNodeCount').textContent = networkData.controlNodes.length + networkData.edgeNodes.length;
            
            // 更新项目头部的快速统计
            const totalNodes = networkData.controlNodes.length + networkData.edgeNodes.length;
            const onlineNodes = networkData.edgeNodes.filter(n => n.status !== 'error').length + networkData.controlNodes.length;
            const trainingNodesCount = networkData.edgeNodes.filter(n => n.status === 'training').length;
            
            document.getElementById('quickNodeCount').textContent = totalNodes;
            document.getElementById('quickOnlineCount').textContent = onlineNodes;
            document.getElementById('quickTrainingCount').textContent = trainingNodesCount;
            
            // Check training completion status
            checkTrainingComplete();
        }
        
        // 检查训练完成状态
        function checkTrainingComplete() {
            const allNodes = networkData.allEdgeNodes;
            const trainingNodes = allNodes.filter(n => n.status === 'training' || n.status === 'idle');
            const completedNodes = allNodes.filter(n => n.status === 'completed');
            const totalActiveNodes = allNodes.filter(n => n.status !== 'error');
            
            // If all active nodes have completed training, show completion status
            if (trainingNodes.length === 0 && completedNodes.length > 0) {
                showTrainingComplete(completedNodes.length);
            } else {
                hideTrainingComplete();
            }
        }
        
        // Show training completion status
        function showTrainingComplete(completedCount) {
            const completeOverlay = document.getElementById('trainingComplete');
            const statsText = document.getElementById('trainingCompleteStats');
            
            if (completeOverlay && statsText) {
                statsText.textContent = `Completed training for ${completedCount} nodes`;
                completeOverlay.style.display = 'block';
            }
        }
        
        // Hide training completion status
        function hideTrainingComplete() {
            const completeOverlay = document.getElementById('trainingComplete');
            if (completeOverlay) {
                completeOverlay.style.display = 'none';
            }
        }
        
        // Fill node tables
        function fillNodeTables() {
            fillControlNodesTable();
            fillEdgeNodesTable();
        }
        
        // Fill control nodes table
        function fillControlNodesTable() {
            const tableBody = document.getElementById('controlNodesTable');
            tableBody.innerHTML = '';
            
            networkData.controlNodes.forEach(node => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 cursor-pointer';
                row.onclick = () => showNodeDetails(node, 'control');
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full mr-3" style="background-color: ${node.color.fill}"></div>
                            <span class="text-sm font-medium text-gray-900">${node.name}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="text-sm text-gray-900">${node.type === 'master' ? 'Master Controller' : node.type === 'participant' ? 'Participant' : 'Observer'}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            Online
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${node.user}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 font-mono">${node.ip}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${networkData.edgeNodes.filter(n => n.status !== 'error').length} nodes</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // Fill edge nodes table
        function fillEdgeNodesTable() {
            const tableBody = document.getElementById('edgeNodesTable');
            tableBody.innerHTML = '';
            
            networkData.allEdgeNodes.forEach(node => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                // Remove row click events, keep only button click events
                
                const statusColorMap = {
                    'training': 'bg-blue-100 text-blue-800',
                    'completed': 'bg-green-100 text-green-800',
                    'idle': 'bg-gray-100 text-gray-800',
                    'error': 'bg-red-100 text-red-800'
                };
                
                const statusTextMap = {
                    'training': 'Training',
                    'completed': 'Completed',
                    'idle': 'Idle',
                    'error': 'Error'
                };
                
                const statusColor = statusColorMap[node.status] || 'bg-gray-100 text-gray-800';
                const statusText = statusTextMap[node.status] || 'Unknown';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-3 h-3 ${node.status === 'error' ? 'bg-red-500' : node.status === 'training' ? 'bg-blue-500' : node.status === 'completed' ? 'bg-green-500' : 'bg-gray-400'} rounded-full mr-3"></div>
                            <span class="text-sm font-medium text-gray-900">${node.name}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusColor}">
                            ${statusText}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="w-full bg-gray-200 rounded-full h-2 mr-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: ${node.progress}%"></div>
                            </div>
                            <span class="text-sm text-gray-900">${node.progress}%</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${node.cpu.toFixed(2)}%</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${node.memory}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${node.gpu.toFixed(2)}%</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${node.heartbeat}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button class="text-indigo-600 hover:text-indigo-900 px-3 py-2 rounded border border-indigo-300 hover:border-indigo-500 bg-transparent cursor-pointer transition-colors duration-200 node-details-btn" data-node-id="${node.id}">View Details</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        

        // Trigger random data transmission animation
        function triggerDataTransmissions() {
            const connections = document.querySelectorAll('.connection-line');
            const trainingConnections = Array.from(connections).filter(line => {
                const edgeNodeId = line.getAttribute('data-to');
                const edgeNode = networkData.edgeNodes.find(n => n.id === edgeNodeId);
                return edgeNode && edgeNode.status === 'training';
            });
            
            // Randomly select 2-5 training connection lines for data transmission (test mode - more connection lines)
            const transmissionCount = Math.min(
                Math.floor(Math.random() * 4) + 2, 
                trainingConnections.length
            );
            
            if (transmissionCount > 0) {
                // Randomly select connection lines
                const shuffled = [...trainingConnections].sort(() => 0.5 - Math.random());
                const selectedConnections = shuffled.slice(0, transmissionCount);
                
                selectedConnections.forEach(line => {
                    // Clear previous transmission animations
                    line.classList.remove('transmitting-down', 'transmitting-up');
                    
                    // Randomly select transmission direction
                    const direction = Math.random() > 0.5 ? 'transmitting-down' : 'transmitting-up';
                    
                    // Slight delay to ensure class is cleared
                    setTimeout(() => {
                        line.classList.add(direction);
                        
                        // Remove class after animation ends
                        setTimeout(() => {
                            line.classList.remove(direction);
                        }, 4000);
                    }, 50);
                });
            }
        }

        // Start real-time updates
        function startRealTimeUpdates() {
            setInterval(() => {
                let hasCompletedNodes = false;
                
                // Randomly start training on idle nodes
                const idleNodes = networkData.allEdgeNodes.filter(n => n.status === 'idle');
                if (idleNodes.length > 0 && Math.random() < 0.3) {
                    const randomIdleNode = idleNodes[Math.floor(Math.random() * idleNodes.length)];
                    randomIdleNode.status = 'training';
                    randomIdleNode.progress = Math.floor(Math.random() * 10); // Start progress
                    randomIdleNode.fadeIn = true; // Mark node for fade-in
                }
                
                // Randomly update training progress
                networkData.allEdgeNodes.forEach(node => {
                    if (node.status === 'training' && node.progress < 100) {
                        node.progress = Math.min(100, node.progress + Math.floor(Math.random() * 3));
                        
                        // Update training statistics
                        if (node.trainingRounds) {
                            node.trainingRounds += Math.floor(Math.random() * 3 + 1);
                            
                            // Update accuracy and loss values
                            if (Math.random() < 0.7) { // 70% probability to improve accuracy
                                node.accuracy = Math.min(99.9, node.accuracy + Math.random() * 0.3);
                                node.loss = Math.max(0.001, node.loss - Math.random() * 0.005);
                            }
                            
                            // Update resource usage history
                            if (node.stats) {
                                // CPU fluctuation
                                const cpuChange = (Math.random() - 0.5) * 10;
                                node.cpu = Math.round((Math.max(10, Math.min(100, node.cpu + cpuChange)) * 100)) / 100;
                                
                                // GPU fluctuation
                                const gpuChange = (Math.random() - 0.5) * 8;
                                node.gpu = Math.round((Math.max(0, Math.min(100, node.gpu + gpuChange)) * 100)) / 100;
                                
                                // Update history records (keep latest 4 values)
                                node.stats.cpuHistory.push(node.cpu);
                                node.stats.gpuHistory.push(node.gpu);
                                node.stats.accuracyHistory.push(Math.round(node.accuracy * 10) / 10);
                                
                                if (node.stats.cpuHistory.length > 4) {
                                    node.stats.cpuHistory.shift();
                                    node.stats.gpuHistory.shift();
                                    node.stats.accuracyHistory.shift();
                                }
                            }
                        }
                        
                        if (node.progress >= 100) {
                            node.status = 'completed';
                            node.fadeOut = true; // Mark node for fade-out
                            hasCompletedNodes = true;
                        }
                    }
                });
                
                // If nodes complete training, delay updating visualization nodes (let fade-out animation play first)
                if (hasCompletedNodes) {
                    // Immediately redraw to show fade-out animation
                    drawNodes();
                    drawConnections();
                    
                    // Update visualization node list after 1 second (remove completed nodes)
                    setTimeout(() => {
                        updateVisualizedNodes();
                        drawNodes();
                        drawConnections();
                        updateStats();
                        fillNodeTables();
                    }, 1000);
                } else {
                    // Normal update
                    updateVisualizedNodes();
                    drawNodes();
                    drawConnections();
                    updateStats();
                    fillNodeTables();
                }
                
                // Random data transmission speed
                const speeds = ['0.8MB/s', '1.2MB/s', '2.1MB/s', '1.5MB/s', '0.9MB/s'];
                document.getElementById('dataTransfer').textContent = speeds[Math.floor(Math.random() * speeds.length)];
                
                // Randomly trigger data transmission animation (80% probability - high frequency test mode)
                if (Math.random() < 0.8) {
                    triggerDataTransmissions();
                }
                
                // Random network latency (if element exists)
                const networkLatencyElement = document.getElementById('networkLatency');
                if (networkLatencyElement) {
                    networkLatencyElement.textContent = `${Math.floor(Math.random() * 20 + 15)}ms`;
                }
                
                // If node details panel is open, update its content in real-time
                if (selectedNode && document.getElementById('nodeDetails').classList.contains('show')) {
                    const updatedNode = networkData.allEdgeNodes.find(n => n.id === selectedNode.id);
                    if (updatedNode) {
                        showNodeDetails(updatedNode, 'edge');
                    }
                }
            }, 3000);
        }
        
        // Control panel functions
        function inviteUser() {
            alert('User invitation feature in development...\n\nWill provide:\n- User invitation link generation\n- Permission settings\n- User management\n- Collaboration control');
        }
        
        function addNode() {
            alert('Add node feature in development...\n\nWill support:\n- Automatic edge device discovery\n- Manual node addition\n- Node configuration\n- Connection testing');
        }
        
        function startTraining() {
            alert('Start training feature in development...\n\nWill include:\n- Training parameter settings\n- Data distribution strategy\n- Model synchronization mechanism\n- Progress monitoring');
        }
        
        // Test function: Complete all training
        function completeAllTraining() {
            networkData.allEdgeNodes.forEach(node => {
                if (node.status === 'training' || node.status === 'idle') {
                    node.status = 'completed';
                    node.progress = 100;
                }
            });
            
            // Redraw interface
            updateVisualizedNodes();
            drawNodes();
            drawConnections();
            updateStats();
            fillNodeTables();
            
            alert('All node training completed!');
        }
        
        function resetView() {
            // Reset visualization view
            initializeVisualization();
            closeNodeDetails();
            alert('View has been reset');
        }
        
        // Edge node table sorting functionality
        function sortEdgeNodes(field) {
            // Update sort direction
            if (currentSortField === field) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortField = field;
                currentSortDirection = 'asc';
            }
            
            // Clear all sort indicators
            const sortIndicators = ['sort-name', 'sort-status', 'sort-progress', 'sort-cpu', 'sort-memory', 'sort-gpu', 'sort-heartbeat'];
            sortIndicators.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.textContent = '⇅';
            });
            
            // Set current sort indicator
            const currentIndicator = document.getElementById(`sort-${field}`);
            if (currentIndicator) {
                currentIndicator.textContent = currentSortDirection === 'asc' ? '↑' : '↓';
            }
            
            // Execute sorting
            networkData.allEdgeNodes.sort((a, b) => {
                let valueA, valueB;
                
                switch(field) {
                    case 'name':
                        valueA = a.name.toLowerCase();
                        valueB = b.name.toLowerCase();
                        break;
                    case 'status':
                        // Status sorting: training > idle > completed > error
                        const statusOrder = { 'training': 1, 'idle': 2, 'completed': 3, 'error': 4 };
                        valueA = statusOrder[a.status] || 5;
                        valueB = statusOrder[b.status] || 5;
                        break;
                    case 'progress':
                        valueA = a.progress || 0;
                        valueB = b.progress || 0;
                        break;
                    case 'cpu':
                        valueA = a.cpu || 0;
                        valueB = b.cpu || 0;
                        break;
                    case 'memory':
                        // Parse memory value (remove GB suffix)
                        valueA = parseFloat(a.memory.replace('GB', '')) || 0;
                        valueB = parseFloat(b.memory.replace('GB', '')) || 0;
                        break;
                    case 'gpu':
                        valueA = a.gpu || 0;
                        valueB = b.gpu || 0;
                        break;
                    case 'heartbeat':
                        // 解析心跳时间（简化处理）
                        const parseHeartbeat = (heartbeat) => {
                            if (heartbeat.includes('sec ago')) {
                                return parseInt(heartbeat.replace(' sec ago', '')) || 0;
                            } else if (heartbeat.includes('min ago')) {
                                return (parseInt(heartbeat.replace(' min ago', '')) || 0) * 60;
                            }
                            return 999; // Other cases go last
                        };
                        valueA = parseHeartbeat(a.heartbeat);
                        valueB = parseHeartbeat(b.heartbeat);
                        break;
                    default:
                        valueA = a[field];
                        valueB = b[field];
                }
                
                if (typeof valueA === 'string' && typeof valueB === 'string') {
                    return currentSortDirection === 'asc' 
                        ? valueA.localeCompare(valueB)
                        : valueB.localeCompare(valueA);
                } else {
                    return currentSortDirection === 'asc' 
                        ? valueA - valueB 
                        : valueB - valueA;
                }
            });
            
            // Refill table
            fillEdgeNodesTable();
        }
        
        // Navigation functionality
        function goBack() {
            window.location.href = '/edgeai/pages/dashboard.html';
        }
    </script>
</body>
</html>