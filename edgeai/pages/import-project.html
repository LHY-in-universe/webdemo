<!DOCTYPE html>
<html lang="zh-CN" data-i18n-title="edgeai.modelManager.title">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡å‹ç®¡ç† - EdgeAI</title>
    <!-- ==================== é˜²ç™½é—ªè„šæœ¬ ==================== -->
    <script>
        (function() {
            'use strict';
            try {
                // è·å–ä¿å­˜çš„ä¸»é¢˜æˆ–ç³»ç»Ÿåå¥½
                const savedTheme = localStorage.getItem('theme');
                const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                const theme = savedTheme || (prefersDark ? 'dark' : 'light');
                
                // ç«‹å³è®¾ç½®ä¸»é¢˜å±æ€§
                document.documentElement.setAttribute('data-theme', theme);
                
                console.log('ğŸ¨ é˜²ç™½é—ª: ä¸»é¢˜å·²è®¾ç½®ä¸º', theme);
            } catch (error) {
                console.warn('âš ï¸ é˜²ç™½é—ªè„šæœ¬å¤±è´¥:', error);
                // é™çº§åˆ°æ·±è‰²ä¸»é¢˜
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>
    
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../shared/css/unified-styles.css?v=1756673001">
    <link rel="stylesheet" href="../../shared/css/animations.css">
</head>
<body class="theme-transition">
    <div class="page-container">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <nav class="page-nav sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <button onclick="goBack()" class="mr-4 text-gray-600 hover:text-gray-900 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                        </button>
                        <h1 class="text-xl font-semibold text-primary" data-i18n="edgeai.modelManager.title">æ¨¡å‹ç®¡ç†</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- ä¸»é¢˜åˆ‡æ¢ -->
                        <button class="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜">
                            <span data-theme-icon>ğŸŒ™</span>
                        </button>
                        <!-- è¯­è¨€åˆ‡æ¢ -->
                        <button class="language-toggle" title="åˆ‡æ¢è¯­è¨€">EN</button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- ä¸»è¦å†…å®¹ -->
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <div class="max-w-4xl mx-auto">
            <!-- é¡µé¢å¤´éƒ¨ -->
            <div class="mb-8">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-primary" data-i18n="edgeai.modelManager.myModelLibrary">æˆ‘çš„æ¨¡å‹åº“</h2>
                        <p class="text-secondary mt-1" data-i18n="edgeai.modelManager.manageAndViewSavedModels">ç®¡ç†å’ŒæŸ¥çœ‹æ‚¨ä¿å­˜çš„AIæ¨¡å‹</p>
                    </div>
                    <button onclick="showAddModelModal()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        <span data-i18n="edgeai.modelManager.addModel">æ·»åŠ æ¨¡å‹</span>
                    </button>
                </div>
            </div>

            <!-- æœç´¢å’Œç­›é€‰ -->
            <div class="card mb-8 fade-in-up">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="searchModel" class="block text-sm font-medium mb-2 text-secondary" data-i18n="edgeai.modelManager.searchModel">æœç´¢æ¨¡å‹</label>
                        <input type="text" id="searchModel" data-i18n-placeholder="edgeai.modelManager.searchModelPlaceholder" placeholder="è¾“å…¥æ¨¡å‹åç§°..." 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               oninput="filterModels()">
                    </div>
                    <div>
                        <label for="filterSize" class="block text-sm font-medium mb-2 text-secondary" data-i18n="edgeai.modelManager.sizeFilter">æŒ‰å¤§å°ç­›é€‰</label>
                        <select id="filterSize" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="filterModels()">
                            <option value="" data-i18n="edgeai.modelManager.allSizes">å…¨éƒ¨å¤§å°</option>
                            <option value="small" data-i18n="edgeai.modelManager.smallSize">å°å‹ (<100MB)</option>
                            <option value="medium" data-i18n="edgeai.modelManager.mediumSize">ä¸­å‹ (100MB-1GB)</option>
                            <option value="large" data-i18n="edgeai.modelManager.largeSize">å¤§å‹ (>1GB)</option>
                        </select>
                    </div>
                    <div>
                        <label for="sortBy" class="block text-sm font-medium mb-2 text-secondary" data-i18n="edgeai.modelManager.sortBy">æ’åºæ–¹å¼</label>
                        <select id="sortBy" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="sortModels()">
                            <option value="name" data-i18n="edgeai.modelManager.byName">æŒ‰åç§°</option>
                            <option value="size" data-i18n="edgeai.modelManager.bySize">æŒ‰å¤§å°</option>
                            <option value="created" data-i18n="edgeai.modelManager.byDate">æŒ‰åˆ›å»ºæ—¶é—´</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- æ¨¡å‹åˆ—è¡¨ -->
            <div class="space-y-6" id="modelsList">
                <!-- æ¨¡å‹é¡¹ç›®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- ç©ºçŠ¶æ€ -->
            <div class="text-center py-12 hidden" id="emptyState">
                <div class="w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center">
                    <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-medium text-gray-900 mb-2" data-i18n="edgeai.modelManager.noModelsYet">è¿˜æ²¡æœ‰æ¨¡å‹</h3>
                <p class="text-gray-600 mb-6" data-i18n="edgeai.modelManager.startAddingModels">å¼€å§‹æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªAIæ¨¡å‹åˆ°åº“ä¸­</p>
                <button onclick="showAddModelModal()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                    <span data-i18n="edgeai.modelManager.addFirstModel">æ·»åŠ ç¬¬ä¸€ä¸ªæ¨¡å‹</span>
                </button>
            </div>
            </div>
        </div>

        <!-- æ·»åŠ æ¨¡å‹æ¨¡æ€æ¡† -->
        <div class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden" id="addModelModal">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="card max-w-4xl w-full max-h-screen overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold text-primary" data-i18n="edgeai.modelManager.addNewModel">æ·»åŠ æ–°æ¨¡å‹</h3>
                            <button onclick="hideAddModelModal()" class="text-tertiary hover:opacity-70">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>

                        <form id="addModelForm" onsubmit="addModel(event)" class="space-y-6">
                            <div>
                                <label for="modelName" class="block text-sm font-medium mb-2 text-secondary" data-i18n="edgeai.modelManager.modelName">æ¨¡å‹åç§° *</label>
                                <input type="text" id="modelName" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       data-i18n-placeholder="ResNet-50å›¾åƒåˆ†ç±»æ¨¡å‹" placeholder="ä¾‹å¦‚ï¼šResNet-50 å›¾åƒåˆ†ç±»æ¨¡å‹">
                            </div>

                            <div>
                                <label for="modelPath" class="block text-sm font-medium mb-2 text-secondary" data-i18n="edgeai.modelManager.modelPath">æ¨¡å‹æœ¬åœ°åœ°å€ *</label>
                                <div class="flex space-x-2">
                                    <input type="text" id="modelPath" required 
                                           class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                           placeholder="/Users/username/models/resnet50.h5">
                                    <button type="button" onclick="browseModelPath()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                        <span data-i18n="edgeai.modelManager.browse">æµè§ˆ</span>
                                    </button>
                                </div>
                                <p class="text-sm mt-1 text-tertiary" data-i18n="edgeai.modelManager.supportedFormats">æ”¯æŒæ ¼å¼: .h5, .pb, .pth, .onnx, .pkl</p>
                            </div>

                            <div>
                                <label for="modelSize" class="block text-sm font-medium mb-2 text-secondary" data-i18n="edgeai.modelManager.modelSize">æ¨¡å‹å¤§å°</label>
                                <div class="flex space-x-2">
                                    <input type="number" id="modelSizeValue" step="0.1" min="0"
                                           class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                           placeholder="123.5">
                                    <select id="modelSizeUnit" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="MB">MB</option>
                                        <option value="GB">GB</option>
                                        <option value="KB">KB</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label for="modelType" class="block text-sm font-medium mb-2 text-secondary" data-i18n="edgeai.modelManager.modelType">æ¨¡å‹ç±»å‹</label>
                                <select id="modelType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="" data-i18n="edgeai.modelManager.selectModelType">è¯·é€‰æ‹©æ¨¡å‹ç±»å‹</option>
                                    <option value="classification" data-i18n="edgeai.modelManager.imageClassification">å›¾åƒåˆ†ç±»</option>
                                    <option value="detection" data-i18n="edgeai.modelManager.objectDetection">ç›®æ ‡æ£€æµ‹</option>
                                    <option value="segmentation" data-i18n="edgeai.modelManager.imageSegmentation">å›¾åƒåˆ†å‰²</option>
                                    <option value="nlp" data-i18n="edgeai.modelManager.naturalLanguageProcessing">è‡ªç„¶è¯­è¨€å¤„ç†</option>
                                    <option value="regression" data-i18n="edgeai.modelManager.regressionPrediction">å›å½’é¢„æµ‹</option>
                                    <option value="clustering" data-i18n="edgeai.modelManager.clusteringAnalysis">èšç±»åˆ†æ</option>
                                    <option value="other" data-i18n="edgeai.modelManager.other">å…¶ä»–</option>
                                </select>
                            </div>

                            <div>
                                <label for="modelDescription" class="block text-sm font-medium mb-2 text-secondary" data-i18n="edgeai.modelManager.modelDescription">æ¨¡å‹æè¿°</label>
                                <textarea id="modelDescription" rows="4" 
                                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                          data-i18n-placeholder="edgeai.modelManager.modelDescriptionPlaceholder" placeholder="æè¿°æ¨¡å‹çš„åŠŸèƒ½ã€ç”¨é€”ã€è®­ç»ƒæ•°æ®é›†ã€æ€§èƒ½æŒ‡æ ‡ç­‰..."></textarea>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="modelFramework" class="block text-sm font-medium mb-2 text-secondary" data-i18n="edgeai.modelManager.framework">æ¡†æ¶</label>
                                    <select id="modelFramework" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="" data-i18n="edgeai.modelManager.selectFramework">è¯·é€‰æ‹©æ¡†æ¶</option>
                                        <option value="tensorflow">TensorFlow</option>
                                        <option value="pytorch">PyTorch</option>
                                        <option value="keras">Keras</option>
                                        <option value="onnx">ONNX</option>
                                        <option value="scikit-learn">Scikit-learn</option>
                                        <option value="other" data-i18n="edgeai.modelManager.other">å…¶ä»–</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="modelVersion" class="block text-sm font-medium mb-2 text-secondary" data-i18n="edgeai.modelManager.version">ç‰ˆæœ¬</label>
                                    <input type="text" id="modelVersion" 
                                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                           data-i18n-placeholder="edgeai.modelManager.versionPlaceholder" placeholder="ä¾‹å¦‚ï¼šv1.0.0">
                                </div>
                            </div>

                            <div class="flex justify-end space-x-3 pt-6">
                                <button type="button" onclick="hideAddModelModal()" class="px-6 py-2 border rounded-lg transition-colors border-primary text-secondary">
                                    <span data-i18n="common.cancel">å–æ¶ˆ</span>
                                </button>
                                <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    <span data-i18n="edgeai.modelManager.addModel">æ·»åŠ æ¨¡å‹</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../../shared/js/navigation-unified.js"></script>
    <script src="../../shared/js/theme-manager-unified.js"></script>
    <script src="../../shared/js/i18n-manager.js?v=1756665500"></script>
    <script>
        // æ¨¡å‹ç®¡ç†ç³»ç»Ÿ
        class ModelManager {
            constructor() {
                this.models = this.loadModels();
                this.filteredModels = [...this.models];
                this.init();
            }

            init() {
                // ç­‰å¾…ä¸€ç‚¹æ—¶é—´ç¡®ä¿æ‰€æœ‰è„šæœ¬åŠ è½½å®Œæˆ
                setTimeout(() => {
                    try {
                        this.renderModels();
                        this.updateEmptyState();
                        if (window.i18nManager) {
                            window.i18nManager.applyTranslations();
                        }
                    } catch (error) {
                        console.error('æ¨¡å‹ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥:', error);
                        // é™çº§æ˜¾ç¤ºï¼Œä½¿ç”¨ç®€å•çš„ä¸­æ–‡æ–‡æœ¬
                        this.renderModelsSimple();
                    }
                }, 200);
            }

            // ä»localStorageåŠ è½½æ¨¡å‹
            loadModels() {
                const saved = localStorage.getItem('edgeai_models');
                if (saved) {
                    return JSON.parse(saved);
                }
                
                // è¿”å›ç¤ºä¾‹æ•°æ®
                return [
                    {
                        id: '1',
                        name: 'ChatGLM-6B å¯¹è¯æ¨¡å‹',
                        path: '/Users/models/chatglm-6b.pth',
                        size: '12.8 GB',
                        sizeBytes: 13743895347,
                        type: 'llm',
                        framework: 'pytorch',
                        version: 'v1.1.0',
                        description: 'åŸºäºGLMæ¶æ„çš„60äº¿å‚æ•°å¯¹è¯è¯­è¨€æ¨¡å‹ï¼Œæ”¯æŒä¸­è‹±åŒè¯­å¯¹è¯ã€ä»£ç ç”Ÿæˆã€æ–‡æœ¬æ‘˜è¦ç­‰ä»»åŠ¡ã€‚',
                        created: new Date('2024-01-15').toISOString()
                    },
                    {
                        id: '2',
                        name: 'Llama2-7B åŸºç¡€æ¨¡å‹',
                        path: '/Users/models/llama2-7b-chat.bin',
                        size: '13.5 GB',
                        sizeBytes: 14495514624,
                        type: 'llm',
                        framework: 'transformers',
                        version: 'v2.0.0',
                        description: 'Metaå¼€æºçš„70äº¿å‚æ•°å¤§è¯­è¨€æ¨¡å‹ï¼Œç»è¿‡æŒ‡ä»¤å¾®è°ƒï¼Œæ“…é•¿å¯¹è¯äº¤äº’å’Œå¤æ‚æ¨ç†ä»»åŠ¡ã€‚',
                        created: new Date('2024-01-20').toISOString()
                    },
                    {
                        id: '3',
                        name: 'Qwen-14B é€šä¹‰åƒé—®',
                        path: '/Users/models/qwen-14b-chat.safetensors',
                        size: '28.2 GB',
                        sizeBytes: 30265318400,
                        type: 'llm',
                        framework: 'transformers',
                        version: 'v1.5.0',
                        description: 'é˜¿é‡Œäº‘é€šä¹‰åƒé—®140äº¿å‚æ•°å¤§æ¨¡å‹ï¼Œæ”¯æŒé•¿æ–‡æœ¬ç†è§£ã€å¤šè½®å¯¹è¯ã€ä»£ç ç”Ÿæˆå’Œæ•°å­¦æ¨ç†ã€‚',
                        created: new Date('2024-02-01').toISOString()
                    }
                ];
            }

            // ä¿å­˜æ¨¡å‹åˆ°localStorage
            saveModels() {
                localStorage.setItem('edgeai_models', JSON.stringify(this.models));
            }

            // æ¸²æŸ“æ¨¡å‹åˆ—è¡¨
            renderModels() {
                const container = document.getElementById('modelsList');
                
                if (this.filteredModels.length === 0) {
                    container.innerHTML = '';
                    this.updateEmptyState();
                    return;
                }

                container.innerHTML = this.filteredModels.map(model => this.renderModelCard(model)).join('');
                this.updateEmptyState();
            }

            // ç®€åŒ–æ¸²æŸ“å‡½æ•°ï¼ˆé™çº§æ–¹æ¡ˆï¼‰
            renderModelsSimple() {
                const container = document.getElementById('modelsList');
                
                if (this.filteredModels.length === 0) {
                    container.innerHTML = '';
                    this.updateEmptyState();
                    return;
                }

                const simpleHtml = this.filteredModels.map(model => `
                    <div class="card" style="border: 1px solid #e5e5e5; padding: 20px; margin-bottom: 16px; border-radius: 8px;">
                        <h3 style="font-size: 18px; font-weight: bold; margin-bottom: 12px;">${model.name}</h3>
                        <p><strong>è·¯å¾„:</strong> ${model.path}</p>
                        <p><strong>å¤§å°:</strong> ${model.size}</p>
                        <p><strong>ç±»å‹:</strong> ${model.type || 'æœªæŒ‡å®š'}</p>
                        <p><strong>æ¡†æ¶:</strong> ${model.framework || 'æœªæŒ‡å®š'}</p>
                        <p><strong>ç‰ˆæœ¬:</strong> ${model.version || 'æœªæŒ‡å®š'}</p>
                        ${model.description ? `<p><strong>æè¿°:</strong> ${model.description}</p>` : ''}
                        <p><strong>åˆ›å»ºæ—¶é—´:</strong> ${new Date(model.created).toLocaleString()}</p>
                        <div style="margin-top: 12px;">
                            <button onclick="viewModelDetails('${model.id}')" style="background: #3b82f6; color: white; padding: 6px 12px; border: none; border-radius: 4px; margin-right: 8px;">æŸ¥çœ‹è¯¦æƒ…</button>
                            <button onclick="useModel('${model.id}')" style="background: #10b981; color: white; padding: 6px 12px; border: none; border-radius: 4px;">ä½¿ç”¨æ¨¡å‹</button>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = simpleHtml;
                this.updateEmptyState();
            }

            // æ¸²æŸ“å•ä¸ªæ¨¡å‹å¡ç‰‡
            renderModelCard(model) {
                const typeColors = {
                    'classification': 'bg-blue-100 text-blue-800',
                    'detection': 'bg-green-100 text-green-800',
                    'segmentation': 'bg-purple-100 text-purple-800',
                    'nlp': 'bg-orange-100 text-orange-800',
                    'regression': 'bg-red-100 text-red-800',
                    'clustering': 'bg-cyan-100 text-cyan-800',
                    'other': 'bg-gray-100 text-gray-800'
                };

                // å®‰å…¨çš„i18nè°ƒç”¨å‡½æ•°
                const safeT = (key, fallback) => {
                    try {
                        return (window.i18nManager && window.i18nManager.t) ? window.i18nManager.t(key) : fallback;
                    } catch (error) {
                        console.warn(`i18n translation failed for key: ${key}`, error);
                        return fallback;
                    }
                };

                const typeNames = {
                    'classification': safeT('edgeai.modelManager.imageClassification', 'å›¾åƒåˆ†ç±»'),
                    'detection': safeT('edgeai.modelManager.objectDetection', 'ç›®æ ‡æ£€æµ‹'),
                    'segmentation': safeT('edgeai.modelManager.imageSegmentation', 'å›¾åƒåˆ†å‰²'),
                    'nlp': safeT('edgeai.modelManager.naturalLanguageProcessing', 'è‡ªç„¶è¯­è¨€å¤„ç†'),
                    'regression': safeT('edgeai.modelManager.regressionPrediction', 'å›å½’é¢„æµ‹'),
                    'clustering': safeT('edgeai.modelManager.clusteringAnalysis', 'èšç±»åˆ†æ'),
                    'other': safeT('edgeai.modelManager.other', 'å…¶ä»–')
                };

                const frameworkNames = {
                    'tensorflow': 'TensorFlow',
                    'pytorch': 'PyTorch',
                    'keras': 'Keras',
                    'onnx': 'ONNX',
                    'scikit-learn': 'Scikit-learn',
                    'other': safeT('edgeai.modelManager.other', 'å…¶ä»–')
                };

                return `
                    <div class="card fade-in-up hover:shadow-xl transition-shadow">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <h3 class="text-xl font-semibold text-primary">${model.name}</h3>
                                    <div class="flex space-x-2">
                                        <button onclick="editModel('${model.id}')" class="text-blue-600 hover:text-blue-800 transition-colors" title="ç¼–è¾‘">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                        </button>
                                        <button onclick="deleteModel('${model.id}')" class="text-red-600 hover:text-red-800 transition-colors" title="åˆ é™¤">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="flex flex-wrap items-center gap-2 mb-3">
                                    ${model.type ? `<span class="px-2 py-1 text-xs font-medium rounded-full ${typeColors[model.type] || typeColors['other']}">${typeNames[model.type] || model.type}</span>` : ''}
                                    ${model.framework ? `<span class="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full">${frameworkNames[model.framework] || model.framework}</span>` : ''}
                                    ${model.version ? `<span class="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-600 rounded-full">${model.version}</span>` : ''}
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <p class="text-sm mb-1 text-tertiary">${safeT('edgeai.modelManager.modelPathLabel', 'æ¨¡å‹è·¯å¾„')}</p>
                                <p class="text-sm font-mono p-2 rounded break-all text-primary bg-tertiary">${model.path}</p>
                            </div>
                            <div>
                                <p class="text-sm mb-1 text-tertiary">${safeT('edgeai.modelManager.modelSizeLabel', 'æ¨¡å‹å¤§å°')}</p>
                                <p class="text-sm font-semibold text-primary">${model.size}</p>
                            </div>
                        </div>

                        ${model.description ? `
                            <div class="mb-4">
                                <p class="text-sm mb-1 text-tertiary">${safeT('edgeai.modelManager.descriptionLabel', 'æè¿°')}</p>
                                <p class="text-sm text-secondary">${model.description}</p>
                            </div>
                        ` : ''}

                        <div class="flex justify-between items-center pt-4 border-t border-primary">
                            <div class="flex items-center text-xs text-tertiary">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                ${safeT('edgeai.modelManager.createdOn', 'åˆ›å»ºäº')} ${new Date(model.created).toLocaleDateString()}
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="viewModelDetails('${model.id}')" class="px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200 transition-colors">
                                    ${safeT('edgeai.modelManager.viewDetails', 'æŸ¥çœ‹è¯¦æƒ…')}
                                </button>
                                <button onclick="useModel('${model.id}')" class="px-3 py-1 text-xs bg-green-100 text-green-700 rounded-full hover:bg-green-200 transition-colors">
                                    ${safeT('edgeai.modelManager.useModel', 'ä½¿ç”¨æ¨¡å‹')}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            // æ›´æ–°ç©ºçŠ¶æ€æ˜¾ç¤º
            updateEmptyState() {
                const emptyState = document.getElementById('emptyState');
                const modelsList = document.getElementById('modelsList');
                
                if (this.filteredModels.length === 0) {
                    emptyState.classList.remove('hidden');
                    modelsList.classList.add('hidden');
                } else {
                    emptyState.classList.add('hidden');
                    modelsList.classList.remove('hidden');
                }
            }

            // æ·»åŠ æ¨¡å‹
            addModel(modelData) {
                const newModel = {
                    id: Date.now().toString(),
                    created: new Date().toISOString(),
                    ...modelData
                };

                this.models.unshift(newModel);
                this.saveModels();
                this.filterModels();
                
                return newModel;
            }

            // åˆ é™¤æ¨¡å‹
            deleteModel(id) {
                this.models = this.models.filter(model => model.id !== id);
                this.saveModels();
                this.filterModels();
            }

            // ç­›é€‰æ¨¡å‹
            filterModels() {
                const searchTerm = document.getElementById('searchModel').value.toLowerCase();
                const sizeFilter = document.getElementById('filterSize').value;
                
                this.filteredModels = this.models.filter(model => {
                    const matchesSearch = model.name.toLowerCase().includes(searchTerm) ||
                                        model.description.toLowerCase().includes(searchTerm);
                    
                    let matchesSize = true;
                    if (sizeFilter) {
                        const sizeBytes = model.sizeBytes || 0;
                        switch(sizeFilter) {
                            case 'small':
                                matchesSize = sizeBytes < 100 * 1024 * 1024; // <100MB
                                break;
                            case 'medium':
                                matchesSize = sizeBytes >= 100 * 1024 * 1024 && sizeBytes < 1024 * 1024 * 1024; // 100MB-1GB
                                break;
                            case 'large':
                                matchesSize = sizeBytes >= 1024 * 1024 * 1024; // >1GB
                                break;
                        }
                    }
                    
                    return matchesSearch && matchesSize;
                });

                this.sortModels();
            }

            // æ’åºæ¨¡å‹
            sortModels() {
                const sortBy = document.getElementById('sortBy').value;
                
                this.filteredModels.sort((a, b) => {
                    switch(sortBy) {
                        case 'name':
                            return a.name.localeCompare(b.name);
                        case 'size':
                            return (b.sizeBytes || 0) - (a.sizeBytes || 0);
                        case 'created':
                            return new Date(b.created) - new Date(a.created);
                        default:
                            return 0;
                    }
                });

                this.renderModels();
            }
        }

        // å…¨å±€å˜é‡
        let modelManager;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            modelManager = new ModelManager();
        });

        // å…¨å±€å‡½æ•°
        function showAddModelModal() {
            document.getElementById('addModelModal').classList.remove('hidden');
        }

        function hideAddModelModal() {
            document.getElementById('addModelModal').classList.add('hidden');
            document.getElementById('addModelForm').reset();
        }

        function browseModelPath() {
            // æ¨¡æ‹Ÿæ–‡ä»¶æµè§ˆå™¨ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­å¯ä»¥ä½¿ç”¨æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†ï¼‰
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.h5,.pb,.pth,.onnx,.pkl,.pt,.model,.weights';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    document.getElementById('modelPath').value = file.name;
                    // è‡ªåŠ¨è®¡ç®—æ–‡ä»¶å¤§å°
                    const sizeInMB = (file.size / (1024 * 1024)).toFixed(1);
                    document.getElementById('modelSizeValue').value = sizeInMB;
                    document.getElementById('modelSizeUnit').value = 'MB';
                }
            };
            input.click();
        }

        function addModel(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const sizeValue = parseFloat(document.getElementById('modelSizeValue').value) || 0;
            const sizeUnit = document.getElementById('modelSizeUnit').value;
            
            // è®¡ç®—å­—èŠ‚æ•°
            let sizeBytes = sizeValue;
            switch(sizeUnit) {
                case 'KB':
                    sizeBytes *= 1024;
                    break;
                case 'MB':
                    sizeBytes *= 1024 * 1024;
                    break;
                case 'GB':
                    sizeBytes *= 1024 * 1024 * 1024;
                    break;
            }

            const modelData = {
                name: document.getElementById('modelName').value,
                path: document.getElementById('modelPath').value,
                size: sizeValue > 0 ? `${sizeValue} ${sizeUnit}` : (window.i18nManager ? window.i18nManager.t('edgeai.modelManager.unknownSize') : 'æœªçŸ¥'),
                sizeBytes: sizeBytes,
                type: document.getElementById('modelType').value,
                framework: document.getElementById('modelFramework').value,
                version: document.getElementById('modelVersion').value,
                description: document.getElementById('modelDescription').value
            };

            const newModel = modelManager.addModel(modelData);
            hideAddModelModal();
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            const successMsg = window.i18nManager ? 
                window.i18nManager.t('edgeai.modelManager.modelAddedSuccess').replace('{name}', newModel.name) : 
                `æ¨¡å‹ "${newModel.name}" æ·»åŠ æˆåŠŸï¼`;
            alert(successMsg);
        }

        function filterModels() {
            modelManager.filterModels();
        }

        function sortModels() {
            modelManager.sortModels();
        }

        function editModel(id) {
            const model = modelManager.models.find(m => m.id === id);
            if (!model) return;
            
            // å¡«å……è¡¨å•æ•°æ®
            document.getElementById('modelName').value = model.name;
            document.getElementById('modelPath').value = model.path;
            document.getElementById('modelType').value = model.type || '';
            document.getElementById('modelFramework').value = model.framework || '';
            document.getElementById('modelVersion').value = model.version || '';
            document.getElementById('modelDescription').value = model.description || '';
            
            // è§£æå¤§å°
            if (model.size && model.size !== 'æœªçŸ¥') {
                const sizeMatch = model.size.match(/^([\d.]+)\s*(\w+)$/);
                if (sizeMatch) {
                    document.getElementById('modelSizeValue').value = sizeMatch[1];
                    document.getElementById('modelSizeUnit').value = sizeMatch[2];
                }
            }
            
            // ä¿®æ”¹è¡¨å•æäº¤å¤„ç†
            const form = document.getElementById('addModelForm');
            form.onsubmit = function(event) {
                event.preventDefault();
                
                const sizeValue = parseFloat(document.getElementById('modelSizeValue').value) || 0;
                const sizeUnit = document.getElementById('modelSizeUnit').value;
                
                let sizeBytes = sizeValue;
                switch(sizeUnit) {
                    case 'KB':
                        sizeBytes *= 1024;
                        break;
                    case 'MB':
                        sizeBytes *= 1024 * 1024;
                        break;
                    case 'GB':
                        sizeBytes *= 1024 * 1024 * 1024;
                        break;
                }

                // æ›´æ–°æ¨¡å‹æ•°æ®
                Object.assign(model, {
                    name: document.getElementById('modelName').value,
                    path: document.getElementById('modelPath').value,
                    size: sizeValue > 0 ? `${sizeValue} ${sizeUnit}` : (window.i18nManager ? window.i18nManager.t('edgeai.modelManager.unknownSize') : 'æœªçŸ¥'),
                    sizeBytes: sizeBytes,
                    type: document.getElementById('modelType').value,
                    framework: document.getElementById('modelFramework').value,
                    version: document.getElementById('modelVersion').value,
                    description: document.getElementById('modelDescription').value
                });

                modelManager.saveModels();
                modelManager.filterModels();
                hideAddModelModal();
                
                // æ¢å¤åŸå§‹æäº¤å¤„ç†
                form.onsubmit = addModel;
                
                const updateMsg = window.i18nManager ? 
                    window.i18nManager.t('edgeai.modelManager.modelUpdatedSuccess').replace('{name}', model.name) : 
                    `æ¨¡å‹ "${model.name}" æ›´æ–°æˆåŠŸï¼`;
                alert(updateMsg);
            };
            
            showAddModelModal();
        }

        function deleteModel(id) {
            const model = modelManager.models.find(m => m.id === id);
            if (!model) return;
            
            const confirmMsg = window.i18nManager ? 
                window.i18nManager.t('edgeai.modelManager.confirmDelete').replace('{name}', model.name) : 
                `ç¡®å®šè¦åˆ é™¤æ¨¡å‹ "${model.name}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`;
            if (confirm(confirmMsg)) {
                modelManager.deleteModel(id);
                const deleteMsg = window.i18nManager ? window.i18nManager.t('edgeai.modelManager.modelDeletedSuccess') : 'æ¨¡å‹åˆ é™¤æˆåŠŸï¼';
                alert(deleteMsg);
            }
        }

        function viewModelDetails(id) {
            const model = modelManager.models.find(m => m.id === id);
            if (!model) return;
            
            const detailsMsg = window.i18nManager ? 
                window.i18nManager.t('edgeai.modelManager.modelDetailsText')
                    .replace('{name}', model.name)
                    .replace('{path}', model.path)
                    .replace('{size}', model.size)
                    .replace('{type}', model.type || window.i18nManager.t('edgeai.modelManager.unspecified'))
                    .replace('{framework}', model.framework || window.i18nManager.t('edgeai.modelManager.unspecified'))
                    .replace('{version}', model.version || window.i18nManager.t('edgeai.modelManager.unspecified'))
                    .replace('{created}', new Date(model.created).toLocaleString())
                    .replace('{description}', model.description || window.i18nManager.t('edgeai.modelManager.noDescription')) :
                `æ¨¡å‹è¯¦æƒ…ï¼š\n\nåç§°ï¼š${model.name}\nè·¯å¾„ï¼š${model.path}\nå¤§å°ï¼š${model.size}\nç±»å‹ï¼š${model.type || 'æœªæŒ‡å®š'}\næ¡†æ¶ï¼š${model.framework || 'æœªæŒ‡å®š'}\nç‰ˆæœ¬ï¼š${model.version || 'æœªæŒ‡å®š'}\nåˆ›å»ºæ—¶é—´ï¼š${new Date(model.created).toLocaleString()}\n\næè¿°ï¼š${model.description || 'æ— æè¿°'}`;
            alert(detailsMsg);
        }

        function useModel(id) {
            const model = modelManager.models.find(m => m.id === id);
            if (!model) return;
            
            const useMsg = window.i18nManager ? 
                window.i18nManager.t('edgeai.modelManager.useModelText').replace('{name}', model.name) :
                `ä½¿ç”¨æ¨¡å‹ "${model.name}"\n\nåŠŸèƒ½å¼€å‘ä¸­ï¼Œå³å°†æ”¯æŒï¼š\n- æ¨¡å‹æ¨ç†æµ‹è¯•\n- æ€§èƒ½åŸºå‡†æµ‹è¯•\n- å¯¼å‡ºåˆ°è®­ç»ƒé¡¹ç›®\n- æ¨¡å‹éƒ¨ç½²`;
            alert(useMsg);
        }

        // æ¨¡æ€æ¡†ç‚¹å‡»å¤–éƒ¨å…³é—­
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('addModelModal');
            if (event.target === modal) {
                hideAddModelModal();
            }
        });

        // ESCé”®å…³é—­æ¨¡æ€æ¡†
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('addModelModal');
                if (!modal.classList.contains('hidden')) {
                    hideAddModelModal();
                }
            }
        });
    </script>
</body>
</html>