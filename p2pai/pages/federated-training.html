<!DOCTYPE html>
<html lang="en" data-i18n-title="p2pai.dashboard.training.federated.title">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Single Model Node</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../../shared/css/unified-styles.css?v=1756673001">
    <script src="../../shared/js/i18n-manager.js"></script>
</head>
<body class="module-background theme-transition">
    <!-- Navigation -->
    <nav class="navbar fade-in-up">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <div class="navbar-brand">
                <button onclick="goBack()" class="mr-4 p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <span data-i18n="p2pai.dashboard.training.federated.standardTitle">Single Model Node</span>
            </div>
            
            <div class="navbar-nav">
                <span id="userInfo" class="text-sm text-gray-600"></span>
                <button class="theme-toggle" title="Toggle Theme">
                    <span data-theme-icon>ğŸŒ™</span>
                </button>
                <button class="language-toggle" title="Switch Language">EN</button>
                <button onclick="logout()" class="btn btn-secondary text-sm btn-click">
                    <span data-i18n="common.logout">é€€å‡ºç™»å½•</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-4xl mx-auto px-6 py-8 content-area">
        <!-- Training Mode Info -->
        <div class="mb-8">
            <div class="card p-6 bg-gray-50 fade-in-up delay-1">
                <div class="flex items-start">
                    <div class="w-12 h-12 bg-gray-600 rounded-lg flex items-center justify-center mr-4">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2" data-i18n="p2pai.dashboard.training.federated.standard">Single Model Node</h3>
                <p class="text-gray-600" data-i18n="p2pai.dashboard.training.federated.standardDesc">Participate in single model node training for better model performance</p>
                        <div class="mt-3 flex items-center text-sm">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800" data-i18n="p2pai.dashboard.training.federated.transparentAggregation">Transparent Model Aggregation</span>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 ml-2" data-i18n="p2pai.dashboard.training.federated.globalProgress">View Global Progress</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Training Configuration -->
        <div class="mb-8">
            <div class="card p-6 fade-in-up delay-2">
                <h2 class="text-2xl font-bold text-gray-900 mb-6" data-i18n="p2pai.dashboard.training.local.trainingConfig">Training Configuration</h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Model Configuration -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="p2pai.dashboard.training.local.modelConfig">Model Configuration</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="p2pai.dashboard.training.local.modelType">Model Type</label>
                        <select class="input" id="modelType">
                            <option value="cnn" data-i18n="p2pai.dashboard.training.local.cnn">Llama</option>
                            <option value="rnn" data-i18n="p2pai.dashboard.training.local.rnn">Gemini</option>
                            <option value="transformer" data-i18n="p2pai.dashboard.training.local.transformer">Deepseek</option>
                            <option value="mlp" data-i18n="p2pai.dashboard.training.local.mlp">Claude</option>
                        </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="p2pai.dashboard.training.local.learningRate">å­¦ä¹ ç‡</label>
                                <input type="number" class="input" value="0.001" step="0.0001" min="0.0001" max="0.1" id="learningRate">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="p2pai.dashboard.training.local.batchSize">æ‰¹æ¬¡å¤§å°</label>
                                <select class="input" id="batchSize">
                                    <option value="16">16</option>
                                    <option value="32" selected>32</option>
                                    <option value="64">64</option>
                                    <option value="128">128</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="p2pai.dashboard.training.local.epochs">è®­ç»ƒè½®æ•°</label>
                                <input type="number" class="input" value="10" min="1" max="100" id="epochs">
                            </div>
                        </div>
                    </div>

                    <!-- Federated Configuration -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="p2pai.dashboard.training.federated.federatedConfig">Federated Training Configuration</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="p2pai.dashboard.training.federated.participants">Expected Number of Participants</label>
                                <input type="number" class="input" value="3" min="2" max="10" id="participants">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="p2pai.dashboard.training.federated.aggregationRounds">Aggregation Rounds</label>
                                <input type="number" class="input" value="5" min="1" max="20" id="aggregationRounds">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="p2pai.dashboard.training.federated.localEpochs">Local Training Epochs</label>
                                <input type="number" class="input" value="2" min="1" max="10" id="localEpochs">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="p2pai.dashboard.training.federated.aggregationMethod">Aggregation Method</label>
                        <select class="input" id="aggregationMethod">
                            <option value="fedavg" data-i18n="p2pai.dashboard.training.federated.fedAvg">FedAvg (Federated Averaging)</option>
                            <option value="fedprox" data-i18n="p2pai.dashboard.training.federated.fedProx">FedProx</option>
                            <option value="scaffold" data-i18n="p2pai.dashboard.training.federated.scaffold">SCAFFOLD</option>
                        </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-between items-center mt-8">
                    <div class="flex space-x-4">
                        <button id="startTrainingBtn" onclick="startTraining()" class="btn btn-primary btn-click">
                            <span data-i18n="p2pai.dashboard.training.local.startTraining">å¼€å§‹è®­ç»ƒ</span>
                        </button>
                        <button id="pauseTrainingBtn" onclick="pauseTraining()" class="btn btn-secondary hidden btn-click">
                            <span data-i18n="p2pai.dashboard.training.local.pauseTraining">Pause Training</span>
                        </button>
                        <button id="stopTrainingBtn" onclick="stopTraining()" class="btn btn-secondary hidden btn-click">
                            <span data-i18n="p2pai.dashboard.training.local.stopTraining">åœæ­¢è®­ç»ƒ</span>
                        </button>
                    </div>
                    <button onclick="resetConfig()" class="btn btn-secondary btn-click">
                        <span data-i18n="p2pai.dashboard.training.federated.resetConfig">é‡ç½®é…ç½®</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Training Status -->
        <div class="grid lg:grid-cols-2 gap-8 mb-8">
            <!-- Training Progress -->
            <div class="card p-6 fade-in-up delay-2">
                <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="p2pai.dashboard.training.local.trainingStatus">è®­ç»ƒçŠ¶æ€</h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-600" data-i18n="p2pai.dashboard.training.local.currentStatus">å½“å‰çŠ¶æ€</span>
                        <span id="trainingStatus" class="text-sm font-semibold text-gray-900" data-i18n="p2pai.dashboard.training.local.notStarted">â— æœªå¼€å§‹</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-600" data-i18n="p2pai.dashboard.training.federated.currentRound">å½“å‰èšåˆè½®æ¬¡</span>
                        <span id="currentRound" class="text-sm font-semibold text-gray-900">0/5</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-600" data-i18n="p2pai.dashboard.training.federated.connectedParticipants">Connected Participants</span>
                        <span id="connectedParticipants" class="text-sm font-semibold text-gray-900">0/3</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-600" data-i18n="p2pai.dashboard.training.local.trainingTime">è®­ç»ƒæ—¶é—´</span>
                        <span id="trainingTime" class="text-sm font-semibold text-gray-900">00:00:00</span>
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-600" data-i18n="p2pai.dashboard.training.local.progress">è¿›åº¦</span>
                            <span id="progressPercentage" class="text-sm font-semibold text-gray-900">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="progressBar" class="bg-gray-600 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="card p-6 fade-in-up delay-2">
                <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="p2pai.dashboard.training.local.performanceMetrics">æ€§èƒ½æŒ‡æ ‡</h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-600" data-i18n="p2pai.dashboard.training.local.currentAccuracy">å½“å‰å‡†ç¡®ç‡</span>
                        <span id="currentAccuracy" class="text-sm font-semibold text-gray-900">0%</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-600" data-i18n="p2pai.dashboard.training.local.currentLoss">å½“å‰æŸå¤±</span>
                        <span id="currentLoss" class="text-sm font-semibold text-gray-900">0.0</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-600" data-i18n="p2pai.dashboard.training.local.bestAccuracy">æœ€ä½³å‡†ç¡®ç‡</span>
                        <span id="bestAccuracy" class="text-sm font-semibold text-gray-900">0%</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-600" data-i18n="p2pai.dashboard.training.federated.globalAccuracy">å…¨å±€å‡†ç¡®ç‡</span>
                        <span id="globalAccuracy" class="text-sm font-semibold text-gray-900">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Training Metrics Chart -->
        <div class="card p-6 mb-8 fade-in-up delay-5">
            <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="p2pai.dashboard.training.local.trainingMetrics">è®­ç»ƒæŒ‡æ ‡</h3>
            <div class="h-80">
                <canvas id="trainingChart"></canvas>
            </div>
        </div>

        <!-- Global Statistics -->
        <div class="card p-6 fade-in-up delay-2">
            <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="p2pai.dashboard.training.federated.globalStatistics">å…¨å±€ç»Ÿè®¡ä¿¡æ¯</h3>
            <div class="grid md:grid-cols-3 gap-6">
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <div class="text-2xl font-bold text-gray-700" id="totalParticipants">0</div>
                    <div class="text-sm text-gray-500" data-i18n="p2pai.dashboard.training.federated.totalParticipants">æ€»å‚ä¸æ–¹</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <div class="text-2xl font-bold text-gray-700" id="totalSamples">0</div>
                    <div class="text-sm text-gray-500" data-i18n="p2pai.dashboard.training.federated.totalSamples">æ€»æ ·æœ¬æ•°</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <div class="text-2xl font-bold text-gray-700" id="averageTime">0s</div>
                    <div class="text-sm text-gray-500" data-i18n="p2pai.dashboard.training.federated.averageRoundTime">å¹³å‡è½®æ¬¡æ—¶é—´</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Back to Home Button -->
    <button class="homepage-return-btn btn-click" onclick="goHome()" title="Back to Home">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
        </svg>
    </button>



    <script>
        // é˜²æ­¢ä»»ä½•è®¤è¯æ£€æŸ¥å¼¹çª—
        window.showSecurityError = function() {
            console.log('Security error blocked for federated training page');
        };
        window.checkServerAuth = function() {
            return { success: true };
        };
        
        // ç¡®ä¿localStorageæœ‰å¿…è¦çš„è®¤è¯ä¿¡æ¯
        if (!localStorage.getItem('user')) {
            const defaultUser = {
                name: 'Server Admin',
                email: 'server@federated.ai',
                type: 'server',
                id: 'server'
            };
            localStorage.setItem('user', JSON.stringify(defaultUser));
        }
        if (!localStorage.getItem('token')) {
            localStorage.setItem('token', 'federated-training-token');
        }
        if (!localStorage.getItem('loginTime')) {
            localStorage.setItem('loginTime', new Date().toISOString());
        }
    </script>
    <!-- å¯ç”¨å›½é™…åŒ–å’Œä¸»é¢˜ç®¡ç†è„šæœ¬ -->
    <script src="../../shared/js/navigation-unified.js?v=20250902"></script>
    <script src="../../shared/js/theme-manager-unified.js?v=20250827"></script>
    <script>
        // åŸºæœ¬å¯¼èˆªå‡½æ•°
        window.goHome = function() {
            console.log("ğŸ  Back to home");
            window.location.href = "/homepage/index.html";
        };
        
        window.goBack = function() {
            console.log("ğŸ”™ è¿”å›ä¸Šä¸€é¡µ");
            window.history.back();
        };
        
        // åŸºæœ¬ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ï¼ˆç®€åŒ–ç‰ˆï¼‰
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('theme-toggle')) {
                const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                // æ›´æ–°æŒ‰é’®æ–‡æœ¬
                e.target.innerHTML = newTheme === 'light' ? '<span>ğŸŒ™</span>' : '<span>â˜€ï¸</span>';
            }
        });
        
        // åº”ç”¨ä¿å­˜çš„ä¸»é¢˜
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
                let trainingInterval;
        let trainingStartTime;
        let currentTrainingStatus = 'not-started';
        let trainingChart;

        function goBack() {
            window.location.href = '/p2pai/pages/federated-training-select.html';
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            localStorage.removeItem('loginTime');
            window.location.href = '/p2pai/pages/login.html';
        }

        function startTraining() {
            currentTrainingStatus = 'training';
            trainingStartTime = Date.now();
            
            document.getElementById('trainingStatus').textContent = window.i18nManager ? window.i18nManager.getTranslation('p2pai.dashboard.training.local.training') : 'â— Training';
            document.getElementById('startTrainingBtn').classList.add('hidden');
            document.getElementById('pauseTrainingBtn').classList.remove('hidden');
            document.getElementById('stopTrainingBtn').classList.remove('hidden');
            
            // æ¨¡æ‹Ÿè”é‚¦è®­ç»ƒè¿›åº¦
            trainingInterval = setInterval(updateTrainingProgress, 1000);
            
            // æ¨¡æ‹Ÿå‚ä¸æ–¹è¿æ¥
            setTimeout(() => {
                document.getElementById('connectedParticipants').textContent = '3/3';
            }, 2000);
        }

        function pauseTraining() {
            if (currentTrainingStatus === 'training') {
                currentTrainingStatus = 'paused';
                clearInterval(trainingInterval);
                document.getElementById('trainingStatus').textContent = window.i18nManager ? window.i18nManager.getTranslation('p2pai.dashboard.training.local.paused') : 'â— Paused';
            document.getElementById('pauseTrainingBtn').textContent = window.i18nManager ? window.i18nManager.getTranslation('p2pai.dashboard.training.local.continueTraining') : 'Continue Training';
            } else if (currentTrainingStatus === 'paused') {
                currentTrainingStatus = 'training';
                trainingInterval = setInterval(updateTrainingProgress, 1000);
                document.getElementById('trainingStatus').textContent = window.i18nManager ? window.i18nManager.getTranslation('p2pai.dashboard.training.local.training') : 'â— Training';
            document.getElementById('pauseTrainingBtn').textContent = window.i18nManager ? window.i18nManager.getTranslation('p2pai.dashboard.training.local.pauseTraining') : 'Pause Training';
            }
        }

        function stopTraining() {
            currentTrainingStatus = 'stopped';
            clearInterval(trainingInterval);
            
            document.getElementById('trainingStatus').textContent = window.i18nManager ? window.i18nManager.getTranslation('p2pai.dashboard.training.local.stopped') : 'â— Stopped';
            document.getElementById('startTrainingBtn').classList.remove('hidden');
            document.getElementById('pauseTrainingBtn').classList.add('hidden');
            document.getElementById('stopTrainingBtn').classList.add('hidden');
        }

        function resetConfig() {
            // é‡ç½®æ‰€æœ‰é…ç½®ä¸ºé»˜è®¤å€¼
            document.getElementById('modelType').selectedIndex = 0;
            document.getElementById('learningRate').value = '0.001';
            document.getElementById('batchSize').selectedIndex = 1;
            document.getElementById('epochs').value = '10';
            document.getElementById('participants').value = '3';
            document.getElementById('aggregationRounds').value = '5';
            document.getElementById('localEpochs').value = '2';
            document.getElementById('aggregationMethod').selectedIndex = 0;
        }

        function updateTrainingProgress() {
            if (currentTrainingStatus !== 'training') return;
            
            const elapsed = Date.now() - trainingStartTime;
            const hours = Math.floor(elapsed / 3600000);
            const minutes = Math.floor((elapsed % 3600000) / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            
            document.getElementById('trainingTime').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // æ¨¡æ‹Ÿè®­ç»ƒè¿›åº¦
            const maxRounds = parseInt(document.getElementById('aggregationRounds').value);
            const progress = Math.min((elapsed / 1000) / (maxRounds * 30), 1); // æ¯è½®30ç§’
            const currentRoundNum = Math.min(Math.floor(progress * maxRounds) + 1, maxRounds);
            
            document.getElementById('progressPercentage').textContent = `${Math.floor(progress * 100)}%`;
            document.getElementById('progressBar').style.width = `${progress * 100}%`;
            document.getElementById('currentRound').textContent = `${currentRoundNum}/${maxRounds}`;
            
            // æ¨¡æ‹ŸæŒ‡æ ‡æ›´æ–°
            const accuracy = Math.min(50 + progress * 40 + Math.random() * 5, 95);
            const loss = Math.max(1.0 - progress * 0.8 + Math.random() * 0.1, 0.1);
            const globalAcc = Math.min(60 + progress * 35 + Math.random() * 3, 98);
            
            document.getElementById('currentAccuracy').textContent = `${accuracy.toFixed(1)}%`;
            document.getElementById('currentLoss').textContent = loss.toFixed(3);
            document.getElementById('globalAccuracy').textContent = `${globalAcc.toFixed(1)}%`;
            document.getElementById('bestAccuracy').textContent = `${Math.max(accuracy, parseFloat(document.getElementById('bestAccuracy').textContent.replace('%', '')) || 0).toFixed(1)}%`;
            
            // æ›´æ–°å…¨å±€ç»Ÿè®¡
            document.getElementById('totalParticipants').textContent = '3';
            document.getElementById('totalSamples').textContent = '15,000';
            document.getElementById('averageTime').textContent = '45s';
            
            // å¦‚æœè®­ç»ƒå®Œæˆ
            if (progress >= 1) {
                currentTrainingStatus = 'completed';
                clearInterval(trainingInterval);
                document.getElementById('trainingStatus').textContent = window.i18nManager ? window.i18nManager.getTranslation('p2pai.dashboard.training.local.completed') : 'â— Training Completed';
                document.getElementById('startTrainingBtn').classList.remove('hidden');
                document.getElementById('pauseTrainingBtn').classList.add('hidden');
                document.getElementById('stopTrainingBtn').classList.add('hidden');
            }
        }

        function initTrainingChart() {
            const ctx = document.getElementById('trainingChart').getContext('2d');
            const localAccuracyLabel = window.i18nManager ? window.i18nManager.getTranslation('p2pai.dashboard.training.local.localAccuracy') : 'æœ¬åœ°å‡†ç¡®ç‡';
            const globalAccuracyLabel = window.i18nManager ? window.i18nManager.getTranslation('p2pai.dashboard.training.federated.globalAccuracy') : 'å…¨å±€å‡†ç¡®ç‡';
            const accuracyAxisLabel = window.i18nManager ? window.i18nManager.getTranslation('p2pai.dashboard.training.local.accuracy') : 'å‡†ç¡®ç‡ (%)';
            const roundAxisLabel = window.i18nManager ? window.i18nManager.getTranslation('p2pai.dashboard.training.federated.currentRound') : 'èšåˆè½®æ¬¡';
            
            trainingChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: localAccuracyLabel,
                        data: [],
                        borderColor: 'rgb(115, 115, 115)',
                        backgroundColor: 'rgba(115, 115, 115, 0.1)',
                        tension: 0.1
                    }, {
                        label: globalAccuracyLabel,
                        data: [],
                        borderColor: 'rgb(82, 82, 82)',
                        backgroundColor: 'rgba(82, 82, 82, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: accuracyAxisLabel
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: roundAxisLabel
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å°è¯•ä»å¤šä¸ªå¯èƒ½çš„localStorageé”®è·å–ç”¨æˆ·ä¿¡æ¯
            let user = JSON.parse(localStorage.getItem('user') || '{}');
            
            // å¦‚æœæ²¡æœ‰userï¼Œå°è¯•ä»å…¶ä»–é”®è·å–æˆ–åˆ›å»ºé»˜è®¤ç”¨æˆ·
            if (!user.name) {
                const userData = localStorage.getItem('userData');
                const userType = localStorage.getItem('userType') || 'server';
                
                if (userData) {
                    try {
                        const parsedData = JSON.parse(userData);
                        user = parsedData;
                    } catch (e) {
                        console.log('Failed to parse userData');
                    }
                }
                
                // å¦‚æœä»ç„¶æ²¡æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œåˆ›å»ºé»˜è®¤ç”¨æˆ·
                if (!user.name) {
                    user = {
                        name: userType === 'server' ? 'Server Admin' : 'Client User',
                        email: userType === 'server' ? 'server@federated.ai' : 'client@federated.ai',
                        type: userType,
                        id: userType === 'server' ? 'server' : 'client1'
                    };
                    // ä¿å­˜é»˜è®¤ç”¨æˆ·ä¿¡æ¯
                    localStorage.setItem('user', JSON.stringify(user));
                }
                
                // ç¡®ä¿tokenå­˜åœ¨
                if (!localStorage.getItem('token')) {
                    const token = btoa(JSON.stringify({
                        userId: user.id,
                        userType: user.type,
                        loginTime: new Date().toISOString()
                    }));
                    localStorage.setItem('token', token);
                }
                
                // ç¡®ä¿loginTimeå­˜åœ¨
                if (!localStorage.getItem('loginTime')) {
                    localStorage.setItem('loginTime', new Date().toISOString());
                }
            }
            
            const userInfo = document.getElementById('userInfo');
            if (user.name) {
                userInfo.textContent = `${user.name}`;
            }
            
            initTrainingChart();
        });
    </script>
</body>
</html>